webpackJsonp([6],{1148:function(t,a,e){"use strict";var o=e(13),i=e.n(o),r=e(14),n=e.n(r),s=e(7),l=e.n(s),c=e(249),d=e.n(c),u=e(58),v=e(12);a.a={name:"BitacorasDetalle",components:{ToolbarList:function(){return new Promise(function(t){t()}).then(e.bind(null,247))},Loading:u.default,InputFile:function(){return e.e(288).then(e.bind(null,748))}},props:{tutelaId:{type:Number,default:0}},data:function(){return{bitacoras:[],bitacora:{},tipos:["Manual","Automatica"],payload:null,numeroTutela:null,menuDate:!1,dialog:!1,loading:!1,tableLoading:!1,loadingSubmit:!1,headers:[{text:"No. tutela",align:"left",sortable:!1,value:"noTutela"},{text:"Tipo",align:"left",sortable:!1,value:"tipo"},{text:"Fecha",align:"left",sortable:!1,value:"fecha"},{text:"Observación",align:"left",sortable:!1,value:"observacion"},{text:"Opciones",align:"left",sortable:!1,value:"id"}]}},created:function(){this.getData(),this.formReset()},computed:{modalTitulo:function(){return this.bitacora.id?"Edición":"Nueva Bitacora"},infoComponent:function(){return this.$store.getters.getInfoComponent("bitacorasDetalle")},computedDateFormatted:function(){return this.formDate(this.bitacora.fecha)}},methods:{getData:function(){var t=this;this.loading=!0,this.tableLoading=!0,this.axios.get("oj_tutelas/"+this.tutelaId).then(function(a){""!==a.data&&(t.bitacoras=a.data.data.bitacoras,t.numeroTutela=a.data.data.no_tutela,t.loading=!1,t.tableLoading=!1)}).catch(function(a){t.loading=!1,t.tableLoading=!1,t.$store.commit(v.b,{msg:"Error al traer los datos básicos de la bitacora. "+a.response,color:"danger"})})},formReset:function(){this.bitacora.archivo&&this.$refs.archivoAdjunto.reset(),this.bitacora={id:"",archivo:null,oj_tutela_id:this.tutelaId,tipo:null,fecha:null,observacion:null}},formDate:function(t){if(!t)return null;var a=t.split("-"),e=d()(a,3);return e[0]+"/"+e[1]+"/"+e[2]},edit:function(t){this.dialog=!0,this.bitacora=JSON.parse(l()(t))},close:function(){this.dialog=!1,this.loadingSubmit=!1,this.formReset(),this.$validator.reset()},validador:function(t){return this.$validator.validateAll(t).then(function(t){return t})},addFormData:function(){var t=new FormData;t.append("id",this.bitacora.id),t.append("oj_tutela_id",this.bitacora.oj_tutela_id),t.append("fecha",this.bitacora.fecha),t.append("tipo",this.bitacora.tipo),t.append("observacion",this.bitacora.observacion),t.append("archivo",void 0===this.bitacora.archivo?"":this.bitacora.archivo),this.payload=t},save:function(){var t=this;return n()(i.a.mark(function a(){var e,o;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.archivoAdjunto.validate("formBitacoras");case 2:return e=a.sent,a.next=5,t.validador("formBitacoras");case 5:if(a.t0=a.sent,!a.t0){a.next=8;break}a.t0=e;case 8:if(!a.t0){a.next=15;break}t.loadingSubmit=!0,t.addFormData(),o=t.bitacora.id?t.axios.post("oj_tutbitacoras/"+t.bitacora.id,t.payload):t.axios.post("oj_tutbitacoras",t.payload),o.then(function(a){t.bitacora.id?(t.$store.commit(v.b,{msg:"La bitacora se actualizó correctamente",color:"success"}),t.bitacoras.splice(t.bitacoras.findIndex(function(t){return t.id===a.data.data.id}),1,a.data.data)):(t.$store.commit(v.b,{msg:"La bitacora se creó correctamente",color:"success"}),t.bitacoras.splice(0,0,a.data.data)),t.close()}).catch(function(a){t.$store.commit(v.b,{msg:"Hay un error al guardar el registro. "+a.response,color:"danger"}),t.close()}),a.next=16;break;case 15:t.$store.commit(v.b,{msg:"Los campos no pueden estar vacios.",color:"danger"});case 16:case"end":return a.stop()}},a,t)}))()}}}},2058:function(t,a,e){var o=e(2059);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);e(456)("1d0eeac5",o,!0,{})},2059:function(t,a,e){a=t.exports=e(455)(!0),a.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"BitacorasDetalle.vue",sourceRoot:""}])},2060:function(t,a,e){"use strict";var o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("v-dialog",{attrs:{width:"720px"},model:{value:t.dialog,callback:function(a){t.dialog=a},expression:"dialog"}},[e("v-form",{attrs:{"data-vv-scope":"formBitacoras"}},[e("v-card",[e("v-card-title",{staticClass:"grey lighten-3 elevation-0"},[e("span",{staticClass:"title"},[t._v(t._s(t.modalTitulo))])]),t._v(" "),e("v-container",{attrs:{fluid:"","grid-list-md":""}},[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|max:150",expression:"'required|max:150'"}],key:"no. tutela",attrs:{label:"No. Tutela","prepend-icon":"description",disabled:"",name:"no. tutela","error-messages":t.errors.collect("no. tutela")},model:{value:t.numeroTutela,callback:function(a){t.numeroTutela=a},expression:"numeroTutela"}})],1),t._v(" "),e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{items:t.tipos,name:"tipo",label:"Tipo","error-messages":t.errors.collect("tipo"),required:""},model:{value:t.bitacora.tipo,callback:function(a){t.$set(t.bitacora,"tipo",a)},expression:"bitacora.tipo"}})],1),t._v(" "),e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-menu",{ref:"menuDate",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","max-width":"290px","min-width":"290px"},model:{value:t.menuDate,callback:function(a){t.menuDate=a},expression:"menuDate"}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY/MM/DD",expression:"'required|date_format:YYYY/MM/DD'"}],attrs:{slot:"activator",label:"Fecha","prepend-icon":"event",readonly:"",name:"fecha","error-messages":t.errors.collect("fecha")},slot:"activator",model:{value:t.computedDateFormatted,callback:function(a){t.computedDateFormatted=a},expression:"computedDateFormatted"}}),t._v(" "),e("v-date-picker",{attrs:{locale:"es","no-title":""},on:{input:function(a){t.menuDate=!1},change:function(){var a=t.$validator.errors.items.findIndex(function(t){return"fecha"===t.field});t.$validator.errors.items.splice(-1!==a?a:0,-1!==a?1:0)}},model:{value:t.bitacora.fecha,callback:function(a){t.$set(t.bitacora,"fecha",a)},expression:"bitacora.fecha"}})],1)],1),t._v(" "),e("v-flex",{attrs:{xs12:"",sm6:""}},[e("v-layout",{attrs:{"align-center":"","fill-height":""}},[e("v-flex",{attrs:{"d-flex":"",xs10:"",sm8:""}},[e("input-file",{ref:"archivoAdjunto",staticClass:"mb-3",attrs:{label:"Adjuntar archivo","file-name":t.bitacora.archivo?t.bitacora.archivo.nombre:null,accept:"application/pdf",hint:"Extenciones aceptadas: pdf","prepend-icon":"attach_file"},model:{value:t.bitacora.archivo,callback:function(a){t.$set(t.bitacora,"archivo",a)},expression:"bitacora.archivo"}})],1),t._v(" "),e("v-flex",{attrs:{"d-flex":"",xs2:"",sm4:""}},[e("v-tooltip",{attrs:{bottom:""}},[e("v-btn",{attrs:{slot:"activator",fab:"",color:"success",small:"",href:t.bitacora.archivo?t.bitacora.archivo.url_signed:"",target:"_blank"},slot:"activator"},[e("v-icon",[t._v("remove_red_eye")])],1),t._v(" "),e("span",[t._v("Ver archivo")])],1)],1)],1)],1),t._v(" "),e("v-flex",{attrs:{xs12:""}},[e("v-textarea",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"observacion",attrs:{label:"Observación","prepend-icon":"format_align_left",name:"observacion","error-messages":t.errors.collect("observacion")},model:{value:t.bitacora.observacion,callback:function(a){t.$set(t.bitacora,"observacion",a)},expression:"bitacora.observacion"}})],1)],1)],1),t._v(" "),e("v-card-actions",{staticClass:"grey lighten-4"},[e("v-spacer"),t._v(" "),e("v-btn",{attrs:{loading:t.loadingSubmit},on:{click:t.close}},[t._v("Cancelar")]),t._v(" "),e("v-btn",{attrs:{color:"primary",loading:t.loadingSubmit,disabled:t.errors.any()},on:{click:t.save}},[t._v("Guardar")])],1)],1)],1)],1),t._v(" "),e("v-card",[e("toolbar-list",{attrs:{info:t.infoComponent,title:"Bitacoras",subtitle:"Registro y gestión",btnplus:"",btnplustitle:"Crear Bitacora",btnplustruncate:""},on:{click:function(a){t.dialog=!0}}}),t._v(" "),e("v-container",{attrs:{fluid:""}},[e("loading",{model:{value:t.loading,callback:function(a){t.loading=a},expression:"loading"}}),t._v(" "),e("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.bitacoras,loading:t.tableLoading,"rows-per-page-text":"Registros por página"},scopedSlots:t._u([{key:"items",fn:function(a){return[e("td",[t._v(t._s(t.numeroTutela))]),t._v(" "),e("td",[t._v(t._s(a.item.tipo))]),t._v(" "),e("td",[t._v(t._s(a.item.fecha))]),t._v(" "),e("td",[t._v(t._s(a.item.observacion))]),t._v(" "),e("td",[e("v-speed-dial",{attrs:{direction:"left","open-on-hover":"",transition:"slide-x-transition"},model:{value:a.item.show,callback:function(e){t.$set(a.item,"show",e)},expression:"props.item.show"}},[e("v-btn",{attrs:{slot:"activator",color:"blue darken-2",dark:"",fab:"",small:""},slot:"activator",model:{value:a.item.show,callback:function(e){t.$set(a.item,"show",e)},expression:"props.item.show"}},[e("v-icon",[t._v("chevron_left")]),t._v(" "),e("v-icon",[t._v("close")])],1),t._v(" "),e("v-tooltip",{attrs:{top:""}},[e("v-btn",{attrs:{slot:"activator",fab:"",dark:"",small:"",color:"white"},on:{click:function(e){return t.edit(a.item)}},slot:"activator"},[e("v-icon",{attrs:{color:"accent"}},[t._v("mode_edit")])],1),t._v(" "),e("span",[t._v("Editar")])],1)],1)],1)]}}])},[t._v(" "),e("template",{slot:"no-data"},[t.tableLoading?e("v-alert",{attrs:{value:!0,color:"info",icon:"info"}},[t._v("\n            Estamos cargando los registros. "),e("v-icon",[t._v("sentiment_satisfied_alt")])],1):e("v-alert",{attrs:{value:!0,color:"error",icon:"warning"}},[t._v("\n            Lo sentimos, no tenemos registros para mostrar. "),e("v-icon",[t._v("sentiment_very_dissatisfied")])],1)],1)],2)],1)],1)],1)},i=[],r={render:o,staticRenderFns:i};a.a=r},470:function(t,a,e){"use strict";function o(t){e(2058)}Object.defineProperty(a,"__esModule",{value:!0});var i=e(1148),r=e(2060),n=e(1),s=o,l=n(i.a,r.a,!1,s,"data-v-2bcc3b8d",null);a.default=l.exports}});
//# sourceMappingURL=6.b9a7e1fbbcc05cfa338d.js.map