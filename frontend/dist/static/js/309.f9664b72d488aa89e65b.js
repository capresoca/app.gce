webpackJsonp([309],{849:function(e,t,a){"use strict";var i=a(13),n=a.n(i),r=a(14),o=a.n(r),s=a(59),c=a(897),d=a(12);t.a={name:"RegistroAnetramites",props:["value","rootPath"],data:function(){return{filtraAnexos:function(e,t){return e=e.filter(function(e){return e.as_afiliado_id===t})},anetramitesPersona:[],paneles:[],personas:[],dialogBorrarAnexo:!1,showFormAnexo:!1,anetramite:null}},components:{RegistroAnetramite:c.a},watch:{"value.anexos":function(e){var t=this;return o()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e){a.next=6;break}return a.next=3,t.arrayUnique();case 3:return a.next=5,t.getPersonas();case 5:t.obtenerPaneles();case 6:case"end":return a.stop()}},a,t)}))()},"value.nucleo_familiar.length":function(){var e=this;return o()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.arrayUnique();case 2:return t.next=4,e.getPersonas();case 4:e.obtenerPaneles();case 5:case"end":return t.stop()}},t,e)}))()}},computed:{complementos:function(){return s.b.getters.complementosRegistroAnetramites},property:function(){switch(this.rootPath){case"formtrasmovs":return"as_formtrasmov_id";case"formafiliaciones":return"as_formafiliacion_id"}}},methods:{arrayUnique:function(){var e={};this.anetramitesPersona=this.value.anexos.filter(function(t){var a=!e[t.as_afiliado_id]||!1;return e[t.as_afiliado_id]=!0,a})},obtenerPaneles:function(){var e=this;this.paneles=[],this.anetramitesPersona.forEach(function(){e.paneles.push(!0)})},returnAnexo:function(e){var t=this;return o()(n.a.mark(function a(){var i;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=t.value.anexos.findIndex(function(t){return t.id===e.id}),t.value.anexos.splice(i>=0?i:0,i>=0?1:0,e),t.showFormAnexo=!1;case 3:case"end":return a.stop()}},a,t)}))()},asignarAnexo:function(e){this.showFormAnexo=!0,this.anetramite=e,this.$vuetify.goTo("#form-anexo")},confirmaBorrarAnexo:function(e){this.anetramite=e,this.dialogBorrarAnexo=!0},cancelarBorrarAnexo:function(){var e=this;this.dialogBorrarAnexo=!1,setTimeout(function(){e.anetramite=null},400)},borrarAnexo:function(){var e=this;this.axios.delete("anetramites/"+this.anetramite.id).then(function(t){200===t.status&&(e.value.anexos.splice(e.value.anexos.findIndex(function(t){return t.id===e.anetramite.id}),1),e.cancelarBorrarAnexo())}).catch(function(t){e.$store.commit(d.a,{expression:" al intentar borrar el anexo. ",error:t})})},getPersonas:function(){var e=this;this.personas=[],this.personas.push({tipo:"Principal",item:this.value.afiliado}),this.value.nucleo_familiar.forEach(function(t){e.personas.push({tipo:"Beneficiario",item:t.beneficiario})})}}}},850:function(e,t,a){"use strict";var i=a(13),n=a.n(i),r=a(14),o=a.n(r),s=a(7),c=a.n(s),d=a(59),l=a(12);t.a={props:["afiliados","tramiteid","objeto","property"],name:"RegistroAfitramite",data:function(){return{loader:null,loadingArchivo:!1,errorArchivo:"",hintAfiliado:"",labelAfiliado:"",anetramite:{},afiliado:null,make:{anexo:{nombre:""},as_afiliado_id:null,as_tipanexo_id:null,as_formafiliacion_id:null,as_formtrasmov_id:null,gn_archivo_id:null,gn_tipo_doc_identidades_id:null,id:null}}},watch:{"errors.items":function(e){e.length&&(e.find(function(e){return"Archivo"===e.field})?this.errorArchivo=e.find(function(e){return"Archivo"===e.field}).msg:this.errorArchivo="")},"anetramite.as_afiliado_id":function(e){e&&(this.hintAfiliado=this.afiliados.find(function(t){return t.item.id===e}).item.identificacion_completa,this.labelAfiliado=this.afiliados.find(function(t){return t.item.id===e}).tipo)},objeto:function(e){e?this.asignaObjeto(e):this.reset()}},computed:{complementos:function(){return d.b.getters.complementosFormAnetramite}},beforeMount:function(){this.reset()},mounted:function(){this.objeto&&this.asignaObjeto(this.objeto)},methods:{onFilePicked:function(e){var t=this,a=e.target.files;if(a.length)if(void 0!==a[0])if("application/pdf"===a[0].type||"image/jpeg"===a[0].type||"image/gif"===a[0].type||"image/png"===a[0].type)if(a[0].name.length<=50){this.errorArchivo="",this.loadingArchivo=!0;var i=new FileReader;i.readAsDataURL(a[0]),i.addEventListener("load",function(e){t.loadingArchivo=!1,e.returnValue?(t.anetramite.anexo.nombre=a[0].name,t.anetramite.anexo.anexo=a[0]):t.errorArchivo="El archivo no se ha podido cargar... intentelo nuevamente."})}else this.errorArchivo="El nombre del archivo que desea cargar es muy largo. Longitud permitida => 50 caracteres.";else this.errorArchivo="El archivo no está en formato de imágen o PDF.";else this.errorArchivo="El archivo no es un archivo válido."},asignaObjeto:function(e){this.anetramite=e},reset:function(){this.$validator.reset(),this.anetramite=JSON.parse(c()(this.make))},submit:function(){var e=this;return o()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$validator.validateAll("formAnetramite").then(function(t){if(t){e.loader=e.$loading.show({container:e.$refs.formAnetramite.$el});var a=new FormData;a.append("anexo",void 0===e.anetramite.anexo.anexo?"":e.anetramite.anexo.anexo),a.append("nombre_archivo",e.anetramite.anexo.nombre),a.append("as_afiliado_id",e.anetramite.as_afiliado_id),a.append("as_tipanexo_id",e.anetramite.as_tipanexo_id),a.append("as_formafiliacion_id","as_formafiliacion_id"===e.property?e.tramiteid:""),a.append("as_formtrasmov_id","as_formtrasmov_id"===e.property?e.tramiteid:""),a.append("id",e.anetramite.id?e.anetramite.id:""),e.axios.post("anetramites",a).then(function(t){t.data.as_afiliado_id=parseInt(t.data.as_afiliado_id),t.data.as_tipanexo_id=parseInt(t.data.as_tipanexo_id),t.data.as_formafiliacion_id=parseInt(t.data.as_formafiliacion_id),t.data.gn_archivo_id=parseInt(t.data.gn_archivo_id),t.data.gn_tipo_doc_identidades_id=parseInt(t.data.gn_tipo_doc_identidades_id),t.data.id=parseInt(t.data.id),e.$emit("submit",t.data),e.loader.hide()}).catch(function(t){e.$store.commit(l.a,{expression:" al registrar el beneficiario. ",error:t}),e.loader.hide()})}});case 1:case"end":return t.stop()}},t,e)}))()}}}},894:function(e,t,a){"use strict";function i(e){a(895)}Object.defineProperty(t,"__esModule",{value:!0});var n=a(849),r=a(901),o=a(1),s=i,c=o(n.a,r.a,!1,s,"data-v-04c00673",null);t.default=c.exports},895:function(e,t,a){var i=a(896);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(456)("73349d78",i,!0,{})},896:function(e,t,a){t=e.exports=a(455)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroAnetramites.vue",sourceRoot:""}])},897:function(e,t,a){"use strict";function i(e){a(898)}var n=a(850),r=a(900),o=a(1),s=i,c=o(n.a,r.a,!1,s,"data-v-1a86b436",null);t.a=c.exports},898:function(e,t,a){var i=a(899);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(456)("21d5a134",i,!0,{})},899:function(e,t,a){t=e.exports=a(455)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroAnetramite.vue",sourceRoot:""}])},900:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{ref:"formAnetramite",attrs:{color:"blue lighten-4"}},[a("v-card-title",[a("strong",[e._v("\n      "+e._s(e.anetramite.id?"actualización de anexo":"nuevo anexo")+"\n    ")])]),e._v(" "),a("v-divider"),e._v(" "),a("v-container",{attrs:{fluid:"","grid-list-lg":""}},[a("v-form",{attrs:{"data-vv-scope":"formAnetramite"}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Tipo anexo",items:e.complementos.tipanexos,"item-value":"id","item-text":"nombre",name:"Tipo anexo",required:"","error-messages":e.errors.collect("Tipo anexo")},model:{value:e.anetramite.as_tipanexo_id,callback:function(t){e.$set(e.anetramite,"as_tipanexo_id",t)},expression:"anetramite.as_tipanexo_id"}})],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:e.labelAfiliado?e.labelAfiliado:"Afiliado",items:e.afiliados,"item-value":"item.id",hint:e.hintAfiliado,"persistent-hint":"","item-text":"item.nombre_completo",name:e.labelAfiliado?e.labelAfiliado:"Afiliado",required:"","error-messages":e.errors.collect(e.labelAfiliado?e.labelAfiliado:"Afiliado")},model:{value:e.anetramite.as_afiliado_id,callback:function(t){e.$set(e.anetramite,"as_afiliado_id",t)},expression:"anetramite.as_afiliado_id"}})],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("input",{ref:"inputAnexo",attrs:{type:"file",hidden:"",accept:"image/jpeg,image/gif,image/png,application/pdf"},on:{change:function(t){return e.onFilePicked(t)}}}),e._v(" "),a("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Archivo","prepend-icon":"attach_file",readonly:"",name:"Archivo",required:"","error-messages":e.errorArchivo,loading:e.loadingArchivo},nativeOn:{click:function(t){return e.$refs.inputAnexo.click()}},model:{value:e.anetramite.anexo.nombre,callback:function(t){e.$set(e.anetramite.anexo,"nombre",t)},expression:"anetramite.anexo.nombre"}})],1)],1)],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{flat:""},nativeOn:{click:function(t){return e.$emit("hide",!0)}}},[e._v("Cancelar")]),e._v(" "),a("v-btn",{attrs:{flat:"",color:"primary"},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("Registrar")])],1)],1)},n=[],r={render:i,staticRenderFns:n};t.a=r},901:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"ma-0 pa-0",attrs:{color:"grey lighten-1"}},[a("v-layout",{attrs:{row:"","justify-center":""}},[a("v-dialog",{attrs:{persistent:"","max-width":"400"},model:{value:e.dialogBorrarAnexo,callback:function(t){e.dialogBorrarAnexo=t},expression:"dialogBorrarAnexo"}},[e.anetramite?a("v-card",[a("v-card-text",{staticClass:"title font-weight-light text-xs-center"},[e._v("\n          ¿Esta seguro de borrar el anexo "),a("strong",[e._v(e._s(e.complementos.tipanexos?e.complementos.tipanexos.find(function(t){return t.id===e.anetramite.as_tipanexo_id}).codigo:""))]),e._v(" perteneciente a "),a("strong",[e._v(e._s(e.personas.find(function(t){return t.item.id===e.anetramite.as_afiliado_id}).item.nombre_completo))]),e._v("?\n        ")]),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{flat:""},on:{click:e.cancelarBorrarAnexo}},[e._v("Cancelar")]),e._v(" "),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return t.stopPropagation(),e.borrarAnexo(t)}}},[e._v("Aceptar")])],1)],1):e._e()],1)],1),e._v(" "),a("v-toolbar",{attrs:{dense:""}},[a("v-icon",[e._v("attach_file")]),e._v(" "),a("v-toolbar-title",[e._v("Anexos registrados")]),e._v(" "),a("v-spacer"),e._v(" "),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{attrs:{slot:"activator",fab:"",right:"",small:"",color:"accent"},nativeOn:{click:function(t){return e.asignarAnexo(null)}},slot:"activator"},[a("v-icon",[e._v("add")])],1),e._v(" "),a("span",[e._v("Agregar anexo")])],1)],1),e._v(" "),a("v-slide-y-transition",[e.showFormAnexo?a("registro-anetramite",{ref:"rAnetramite",attrs:{property:e.property,afiliados:e.personas,tramiteid:e.value.id,objeto:JSON.parse(JSON.stringify(e.anetramite))},on:{hide:function(t){return e.showFormAnexo=!t},submit:function(t){return e.returnAnexo(t)}}}):e._e()],1),e._v(" "),e.anetramitesPersona&&e.anetramitesPersona.length?e._e():a("v-list",{attrs:{subheader:""}},[a("v-subheader",{attrs:{inset:""}},[e._v("Ninguno de los integrantes tiene anexos registrados.")])],1),e._v(" "),e.paneles.length?a("v-expansion-panel",{attrs:{value:e.paneles,expand:""}},e._l(e.anetramitesPersona,function(t,i){return e.anetramitesPersona.length&&e.personas.length?a("v-expansion-panel-content",{key:i,staticClass:"pt-2"},[a("div",{staticClass:"pt-1",attrs:{slot:"header"},slot:"header"},[a("div",[e._v(" "+e._s(e.personas.find(function(e){return e.item.id===t.as_afiliado_id}).item.nombre_completo)+" "),a("small",{staticClass:"grey--text"},[e._v(e._s(e.personas.find(function(e){return e.item.id===t.as_afiliado_id}).tipo))])]),e._v(" "),a("div",[e._v(" "+e._s(e.personas.find(function(e){return e.item.id===t.as_afiliado_id}).item.identificacion_completa)+" ")])]),e._v(" "),a("v-card",[a("v-card-text",{staticClass:"py-0"},e._l(e.filtraAnexos(e.value.anexos,t.as_afiliado_id),function(t,i){return a("v-chip",{key:i,attrs:{color:"grey "+(t.gn_archivo_id?"lighten-2":"")}},[a("v-avatar",{staticClass:"accent",attrs:{dark:""}},[e._v(e._s(e.complementos.tipanexos?e.complementos.tipanexos.find(function(e){return e.id===t.as_tipanexo_id}).codigo:""))]),e._v(" "),a("v-tooltip",{attrs:{top:""}},[a("span",{attrs:{slot:"activator"},slot:"activator"},[t.gn_archivo_id?a("a",{attrs:{href:t.anexo.url_signed,target:"_blank"}},[e._v(e._s(e._f("textTruncate")(e.complementos.tipanexos?e.complementos.tipanexos.find(function(e){return e.id===t.as_tipanexo_id}).nombre+(e.complementos.tipdocidentidades&&t.gn_tipo_doc_identidades_id&&1===t.as_tipanexo_id?": "+e.complementos.tipdocidentidades.find(function(e){return e.id===t.gn_tipo_doc_identidades_id}).nombre:""):"",48)))]):a("p",{staticClass:"pt-3"},[e._v(e._s(e._f("textTruncate")(e.complementos.tipanexos?e.complementos.tipanexos.find(function(e){return e.id===t.as_tipanexo_id}).nombre+(e.complementos.tipdocidentidades&&t.gn_tipo_doc_identidades_id&&1===t.as_tipanexo_id?": "+e.complementos.tipdocidentidades.find(function(e){return e.id===t.gn_tipo_doc_identidades_id}).nombre:""):"",48)))])]),e._v(" "),a("span",[e._v(e._s(e.complementos.tipanexos?e.complementos.tipanexos.find(function(e){return e.id===t.as_tipanexo_id}).nombre+(e.complementos.tipdocidentidades&&t.gn_tipo_doc_identidades_id&&1===t.as_tipanexo_id?": "+e.complementos.tipdocidentidades.find(function(e){return e.id===t.gn_tipo_doc_identidades_id}).nombre:""):""))])]),e._v(" "),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{staticClass:"ma-0 ml-2",attrs:{slot:"activator",small:"",ripple:"",icon:""},on:{click:function(a){return a.stopPropagation(),e.asignarAnexo(t)}},slot:"activator"},[a("v-icon",{attrs:{small:"",color:"accent"}},[e._v("mode_edit")])],1),e._v(" "),a("span",[e._v("Editar")])],1),e._v(" "),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{staticClass:"ma-0",attrs:{slot:"activator",small:"",ripple:"",icon:""},on:{click:function(a){return a.stopPropagation(),e.confirmaBorrarAnexo(t)}},slot:"activator"},[a("v-icon",{attrs:{small:"",color:"accent"}},[e._v("close")])],1),e._v(" "),a("span",[e._v("Borrar")])],1)],1)}),1)],1)],1):e._e()}),1):e._e()],1)},n=[],r={render:i,staticRenderFns:n};t.a=r}});
//# sourceMappingURL=309.f9664b72d488aa89e65b.js.map