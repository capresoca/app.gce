webpackJsonp([161],{1197:function(e,t,r){"use strict";var o=r(23),s=r.n(o),a=r(7),i=r.n(a),n=r(12),l=r(59),u=r(58),d=r(40),c=r(248),v=r(251);t.a={name:"PresupuestoInicialDeIngresos",props:["parametros"],components:{Loading:u.default},data:function(){return{presupuesto:null,entidad:null,presupuestos:[],rubros:[],detalle:{},dialogConfirm:!1,detalleAEliminar:{},localLoading:!1,valorPresupuesto:0,seEstaCreando:!1,rubrosCreados:"",tableLoading:!1,loadingSubmit:!1,dialog:!1,headers:[{text:"Rubro",align:"left",sortable:!1,value:"rubro"},{text:"Nombre",align:"left",sortable:!1,value:"nombre"},{text:"Tipo",align:"left",sortable:!1,value:"tipo"},{text:"Valor",align:"left",sortable:!1,value:"valor"},{text:"Opciones",align:"center",sortable:!1,value:"id"}]}},beforeMount:function(){this.presupuesto={entidad_resolucion:{id:"",periodo:null,rubro:null,codigo:null,resolucion:null,valor:null,nombre:null},detalles:[],estado:""},this.validadorPostulador()},mounted:function(){null!==this.parametros.entidad?this.getRegisto(this.parametros.entidad.id):this.obtenerPresupuestos(),this.formReset(),this.obtenerArbol(),this.obtenerRubros();var e={custom:{rubro:{not_in:"Este rubro ya fue registrado."}}};this.$validator.localize("es",e)},computed:{complementos:function(){return JSON.parse(i()(l.b.getters.complementosPresupuesto))},iconoEstado:function(){return"Registrada"===this.presupuesto.estado?"stars":"Confirmada"===this.presupuesto.estado?"check_circle":void 0},colorEstado:function(){return"Registrada"===this.presupuesto.estado?"primary":"Confirmada"===this.presupuesto.estado?"teal":void 0}},watch:{"detalle.pr_rubro_id":function(e){e&&(this.detalle.rubro=this.rubros.find(function(t){return t.id===e}))}},methods:{imprimir:function(e){var t=this;this.axios.get("firmar-ruta?nombre_ruta=reporte-pr-ingresos&id="+e).then(function(e){var t=e.data;window.open(t,"_blank").focus()}).catch(function(){t.$store.commit(n.b,{msg:"Error al abrir el archivo de impresión. ",color:"danger"})})},getRegisto:function(e){var t=this,r=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("pr_stringresos/"+e).then(function(e){""!==e.data&&(t.presupuesto=e.data.data,t.calcularValorPresupuesto(),t.formReset()),r.hide()}).catch(function(e){r.hide(),t.$store.commit(n.b,{msg:"Hay un error al traer el registro. "+e,color:"danger"})})},obtenerPresupuesto:function(e){var t=this,r=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("entidades_resolucion/"+e).then(function(e){""!==e.data&&(t.entidad=e.data.data,t.llenarPresupuesto(),t.calcularValorPresupuesto()),r.hide()}).catch(function(e){r.hide(),t.$store.commit(n.b,{msg:"Hay un error al traer el registro. "+e,color:"danger"})})},obtenerPresupuestos:function(){var e=this;this.seEstaCreando=!0;var t=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("periodos_stringresos").then(function(r){""!==r.data&&(e.presupuestos=r.data),t.hide()}).catch(function(r){t.hide(),e.$store.commit(n.a,{expression:" al obtener presupuesto. ",error:r})})},obtenerArbol:function(){var e=this;this.axios.get("presupuesto/arbol?tipo_rubro=Ingresos").then(function(t){e.options=t.data}).catch(function(t){e.$store.commit(n.b,{msg:"Hay un error al traer el árbol. "+t,color:"danger"})})},obtenerRubros:function(){var e=this,t=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("rubros?tipo_rubro=Ingresos").then(function(r){""!==r.data.data&&(e.rubros=r.data.data),t.hide()}).catch(function(r){t.hide(),e.$store.commit(n.a,{expression:" al obtener rubros. ",error:r})})},llenarPresupuesto:function(){this.presupuesto.periodo=this.entidad.periodo,this.presupuesto.pr_entidad_resolucion_id=this.entidad.id,this.presupuesto.estado="Registrada",this.presupuesto.entidad_resolucion=this.entidad},calcularValorPresupuesto:function(){var e=this;this.valorPresupuesto=0,this.presupuesto.detalles.map(function(t){e.valorPresupuesto+=parseInt(t.valor_inicial)})},getRubrosUsados:function(){var e=this;return this.presupuesto.detalles.map(function(t){if(null==e.detalle.rubro.id||e.detalle.rubro.id!==t.rubro.id)return t.rubro.id})},formReset:function(){this.detalle={rubro:{id:"",codigo:""},tipo_ingreso:{nombre:null},rubro_sin_pagar:0,valor_inicial:null},this.$validator.reset()},abrirModal:function(){this.dialog=!0,this.rubrosCreados=this.getRubrosUsados()},agregarDetalle:function(e){var t=this;"number"!=typeof e.index?this.presupuesto.detalles.push(e):this.presupuesto.detalles.splice(this.presupuesto.detalles.findIndex(function(r){return t.presupuesto.detalles.indexOf(r)===e.index}),1,e),this.calcularValorPresupuesto(),this.dialog=!1,this.formReset()},editarDetalle:function(e,t){this.detalle=JSON.parse(i()(t)),this.detalle.index=e,this.rubrosCreados=this.getRubrosUsados(),this.abrirModal()},eliminarDetalle:function(e){this.presupuesto.detalles.splice(e,1),this.calcularValorPresupuesto(),this.dialogConfirm=!1},filterRubros:function(e,t){var r=function(e){return null!=e?e:""},o=r(e.nombre+" "+e.codigo),s=r(t);return o.toString().toLowerCase().indexOf(s.toString().toLowerCase())>-1},validadorPostulador:function(){var e=this;v.a.extend("rubroValido",{validate:function(t,r){return new s.a(function(r){var o={};if(null!==t&&void 0!==t&&""!==t)return o=e.rubrosCreados.includes(t.id)?{valido:!1,mensaje:"Rubro ya usado"}:{valido:!0,mensaje:null},r({valid:o.valido,data:{message:o.mensaje}})})},getMessage:function(e,t,r){return r.message}})},close:function(){this.dialog=!1,this.formReset()},confirmar:function(){this.presupuesto.estado="Confirmada",this.submit()},submit:function(){var e=this;this.localLoading=!0;var t=this.seEstaCreando?"crear":"editar";(this.seEstaCreando?this.axios.post("pr_stringresos",this.presupuesto):this.axios.put("pr_stringresos/"+this.presupuesto.id,this.presupuesto)).then(function(r){e.seEstaCreando?(e.$store.commit(n.b,{msg:"Item creado satisfactoriamente",color:"success"}),e.$store.commit(c._8,{item:r.data.data,estado:t,key:e.parametros.key}),e.$store.dispatch(d.c,{contexto:e,itemId:e.parametros.tabOrigin})):(e.$store.commit(n.b,{msg:"Item actualizado satisfactoriamente",color:"success"}),e.$store.commit(c._8,{item:r.data.data,estado:t,key:e.parametros.key}),e.$store.dispatch(d.c,{contexto:e,itemId:e.parametros.tabOrigin}))}).catch(function(t){e.localLoading=!1,e.$store.commit(n.b,{msg:"Hay un error al guardar el registro. "+t,color:"danger"})})}}}},2131:function(e,t,r){var o=r(2132);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);r(456)("ee878202",o,!0,{})},2132:function(e,t,r){t=e.exports=r(455)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"PresupuestoInicialDeIngresos.vue",sourceRoot:""}])},2133:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-dialog",{attrs:{width:"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-form",{attrs:{"data-vv-scope":"formCajas"}},[r("v-card",[r("v-card-title",{staticClass:"grey lighten-3 elevation-0"},[r("span",{staticClass:"title"},[e._v("Nuevo rubro")])]),e._v(" "),r("v-container",{attrs:{fluid:"","grid-list-md":""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required|rubroValido",expression:"'required|rubroValido'"}],attrs:{label:"Rubro",items:e.rubros,filter:e.filterRubros,hint:e.detalle.rubro?e.detalle.rubro.codigo:"","persistent-hint":"","item-text":"nombre","item-value":"id",name:"rubro","prepend-icon":"subtitles",required:"",required:"","return-object":"","error-messages":e.errors.collect("rubro")},on:{change:function(t){return e.detalle.pr_rubro_id=t?t.id:null}},scopedSlots:e._u([{key:"item",fn:function(t){return[[r("v-list-tile-content",[r("v-list-tile-title",{domProps:{innerHTML:e._s(t.item.nombre)}}),e._v(" "),r("v-list-tile-sub-title",{domProps:{innerHTML:e._s(t.item.codigo)}})],1)]]}}]),model:{value:e.detalle.rubro,callback:function(t){e.$set(e.detalle,"rubro",t)},expression:"detalle.rubro"}})],1),e._v(" "),r("v-flex",{attrs:{xs12:""}},[r("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Tipo ingreso",items:e.complementos.tipoIngresos,"item-value":"id","item-text":"nombre",name:"tipo ingreso","prepend-icon":"compare_arrows",required:"","return-object":"","error-messages":e.errors.collect("tipo ingreso")},on:{change:function(t){return e.detalle.pr_tipo_ingreso_id=t?t.id:null}},scopedSlots:e._u([{key:"item",fn:function(t){return[[r("v-list-tile-content",[r("v-list-tile-title",{domProps:{innerHTML:e._s(t.item.nombre)}}),e._v(" "),r("v-list-tile-sub-title",{domProps:{innerHTML:e._s(t.item.nombre_departamento)}})],1)]]}}]),model:{value:e.detalle.tipo_ingreso,callback:function(t){e.$set(e.detalle,"tipo_ingreso",t)},expression:"detalle.tipo_ingreso"}})],1),e._v(" "),r("v-flex",{attrs:{xs12:""}},[r("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|numeric",expression:"'required|numeric'"}],attrs:{label:"Valor","prepend-icon":"attach_money",name:"valor",required:"","error-messages":e.errors.collect("valor")},model:{value:e.detalle.valor_inicial,callback:function(t){e.$set(e.detalle,"valor_inicial",t)},expression:"detalle.valor_inicial"}})],1)],1)],1),e._v(" "),r("v-card-actions",{staticClass:"grey lighten-4"},[r("v-spacer"),e._v(" "),r("v-btn",{on:{click:e.close}},[e._v("Cancelar")]),e._v(" "),r("v-btn",{attrs:{color:"primary",disabled:e.errors.any()},on:{click:function(t){return e.agregarDetalle(e.detalle)}}},[e._v("Guardar")])],1)],1)],1)],1),e._v(" "),r("v-card",{ref:"formPresupuesto"},[r("v-toolbar",{staticClass:"grey lighten-3 elevation-0 toolbar--dense"},[r("v-toolbar-title",[e._v(" Presupuesto inicial de ingresos ")]),e._v(" "),r("v-spacer"),e._v(" "),e.seEstaCreando?e._e():r("v-chip",{attrs:{color:e.colorEstado,"text-color":"white"}},[r("v-avatar",[r("v-icon",[e._v(e._s(e.iconoEstado))])],1),e._v("\n        "+e._s(e.presupuesto.estado)+"\n      ")],1)],1),e._v(" "),r("v-container",{staticStyle:{"max-width":"inherit"},attrs:{"grid-list-md":""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-form",{attrs:{"data-vv-scope":"formLiquidaciones"}},[r("v-container",{attrs:{fluid:"","grid-list-md":""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{staticClass:"pb-4",attrs:{xs12:""}},[r("v-card",[r("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[r("v-toolbar-title",{staticClass:"subheading"},[r("v-icon",[e._v("assignment_ind")]),e._v(" General")],1)],1),e._v(" "),r("v-card-text",[r("v-layout",{attrs:{row:"",wrap:""}},[null!==this.parametros.entidad?r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-text-field",{key:"periodo",attrs:{"prepend-icon":"calendar_today",label:"Periodo",readonly:""},model:{value:e.presupuesto.entidad_resolucion.periodo,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"periodo",t)},expression:"presupuesto.entidad_resolucion.periodo"}})],1):r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{items:e.presupuestos,name:"periodo",label:"Periodo","no-data-text":"No hay resoluciones disponibles","error-messages":e.errors.collect("periodo"),required:"","prepend-icon":"calendar_today"},on:{change:function(t){return e.obtenerPresupuesto(t)}},model:{value:e.presupuesto.entidad_resolucion.periodo,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"periodo",t)},expression:"presupuesto.entidad_resolucion.periodo"}})],1),e._v(" "),r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-text-field",{key:"unidad ejecturoa",attrs:{"prepend-icon":"account_balance",label:"Unidad ejecutora",readonly:""},model:{value:e.presupuesto.entidad_resolucion.codigo,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"codigo",t)},expression:"presupuesto.entidad_resolucion.codigo"}})],1),e._v(" "),r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-text-field",{key:"nombre",attrs:{"prepend-icon":"account_balance",label:"Nombre",readonly:""},model:{value:e.presupuesto.entidad_resolucion.nombre,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"nombre",t)},expression:"presupuesto.entidad_resolucion.nombre"}})],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{staticClass:"pb-4",attrs:{xs12:""}},[r("v-card",[r("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[r("v-toolbar-title",{staticClass:"subheading"},[r("v-icon",[e._v("monetization_on")]),e._v(" Presupuesto")],1)],1),e._v(" "),r("v-card-text",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-card",[r("v-card-title",[r("h4",[e._v("Resolución")])]),e._v(" "),r("v-divider"),e._v(" "),r("v-list",{attrs:{dense:""}},[r("v-list-tile",[r("v-list-tile-content",[e._v(e._s(e.presupuesto.entidad_resolucion.resolucion))])],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-card",[r("v-card-title",[r("h4",[e._v("Valor resolución")])]),e._v(" "),r("v-divider"),e._v(" "),r("v-list",{attrs:{dense:""}},[r("v-list-tile",[r("v-list-tile-content",{staticClass:"align-center"},[e._v(e._s(e._f("numberFormat")(e.presupuesto.entidad_resolucion.valor,0,"$")))])],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-card",[r("v-card-title",[r("h4",[e._v("Valor presupuesto")])]),e._v(" "),r("v-divider"),e._v(" "),r("v-list",{attrs:{dense:""}},[r("v-list-tile",[r("v-list-tile-content",{staticClass:"align-center"},[e._v(e._s(e._f("numberFormat")(e.valorPresupuesto,0,"$")))])],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs12:"",sm4:""}},[r("v-card",[r("v-card-title",[r("h4",[e._v("Diferencia")])]),e._v(" "),r("v-divider"),e._v(" "),r("v-list",{attrs:{dense:""}},[r("v-list-tile",[r("v-list-tile-content",{staticClass:"align-center"},[e._v(e._s(e._f("numberFormat")(parseInt(e.presupuesto.entidad_resolucion.valor)-e.valorPresupuesto,0,"$",[".",".","-"])))])],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs12:""}},[[r("loading",{model:{value:e.localLoading,callback:function(t){e.localLoading=t},expression:"localLoading"}}),e._v(" "),r("v-card",[r("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[r("v-toolbar-title",{staticClass:"subheading"},[e._v("Rubros")]),e._v(" "),r("v-spacer"),e._v(" "),"Confirmada"!==e.presupuesto.estado?r("v-btn",{attrs:{small:"",color:"primary"},on:{click:function(t){return t.preventDefault(),e.abrirModal(t)}}},[r("v-icon",[e._v("add")]),e._v(" Agregar Rubro")],1):e._e()],1),e._v(" "),r("v-data-table",{attrs:{headers:e.headers,items:e.presupuesto.detalles,loading:e.tableLoading,"hide-actions":"","rows-per-page-text":"Registros por página","rows-per-page-items":[5,10,25,{text:"Todos",value:-1}]},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.rubro.codigo))]),e._v(" "),r("td",[e._v(e._s(t.item.rubro.nombre))]),e._v(" "),r("td",[e._v(e._s(t.item.tipo_ingreso.nombre))]),e._v(" "),r("td",{staticClass:"text-xs-right"},[e._v(e._s(e._f("numberFormat")(t.item.valor_inicial,0,"$")))]),e._v(" "),r("td",{staticClass:"text-xs-center"},["Confirmada"!==e.presupuesto.estado?r("v-speed-dial",{attrs:{direction:"left","open-on-hover":"",transition:"slide-x-transition"},model:{value:t.item.show,callback:function(r){e.$set(t.item,"show",r)},expression:"props.item.show"}},[r("v-btn",{attrs:{slot:"activator",color:"blue darken-2",dark:"",fab:"",small:""},slot:"activator",model:{value:t.item.show,callback:function(r){e.$set(t.item,"show",r)},expression:"props.item.show"}},[r("v-icon",[e._v("chevron_left")]),e._v(" "),r("v-icon",[e._v("close")])],1),e._v(" "),r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",fab:"",dark:"",small:"",color:"white"},on:{click:function(r){return e.editarDetalle(t.index,t.item)}},slot:"activator"},[r("v-icon",{attrs:{color:"accent"}},[e._v("mode_edit")])],1),e._v(" "),r("span",[e._v("Editar")])],1),e._v(" "),r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",fab:"",dark:"",small:"",color:"white"},on:{click:function(r){return e.eliminarDetalle(t.index,t.item.id)}},slot:"activator"},[r("v-icon",{attrs:{color:"accent"}},[e._v("delete")])],1),e._v(" "),r("span",[e._v("Eliminar")])],1)],1):e._e()],1)]}},{key:"pageText",fn:function(t){return[e._v("\n                                  "+e._s(t.pageStart)+" - "+e._s(t.pageStop)+" de "+e._s(t.itemsLength)+"\n                                ")]}}])},[e._v(" "),r("template",{slot:"no-data"},[e.tableLoading?r("v-alert",{attrs:{value:!0,color:"info",icon:"info"}},[e._v("\n                                    Estamos cargando los registros. "),r("v-icon",[e._v("sentiment_satisfied_alt")])],1):r("v-alert",{attrs:{value:!0,color:"error",icon:"warning"}},[e._v("\n                                    Lo sentimos, no tenemos registros para mostrar. "),r("v-icon",[e._v("sentiment_very_dissatisfied")])],1)],1)],2)],1)]],2)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1),e._v(" "),r("v-divider"),e._v(" "),"Confirmada"!==e.presupuesto.estado?r("v-card-actions",{staticClass:"grey lighten-4"},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{staticClass:"text-xs-right",attrs:{xs12:""}},["Confirmada"!==e.presupuesto.estado?r("v-btn",{attrs:{color:"primary",loading:e.loadingSubmit},on:{click:function(t){return t.preventDefault(),e.submit(t)}}},[e._v("Guardar")]):e._e(),e._v(" "),"Confirmada"!==e.presupuesto.estado&&parseInt(e.presupuesto.entidad_resolucion.valor)!==e.valorPresupuesto?r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",color:"success",disabled:parseInt(e.presupuesto.entidad_resolucion.valor)!==e.valorPresupuesto},on:{click:e.confirmar},slot:"activator"},[e.seEstaCreando?r("span",[e._v("Guardar y Confirmar")]):r("span",[e._v("Confirmar")])]),e._v(" "),r("span",[e._v("El valor de la resolución y el valor del presupuesto deben ser iguales")])],1):r("v-btn",{attrs:{slot:"activator",color:"success"},on:{click:e.confirmar},slot:"activator"},[e.seEstaCreando?r("span",[e._v("Guardar y Confirmar")]):r("span",[e._v("Confirmar")])]),e._v(" "),e.presupuesto.id?r("v-btn",{attrs:{color:"accent"},on:{click:function(t){return e.imprimir(e.presupuesto.id)}}},[r("v-icon",{domProps:{textContent:e._s("far fa-file-pdf")}})],1):e._e()],1)],1)],1):e._e()],1)],1)},s=[],a={render:o,staticRenderFns:s};t.a=a},651:function(e,t,r){"use strict";function o(e){r(2131)}Object.defineProperty(t,"__esModule",{value:!0});var s=r(1197),a=r(2133),i=r(1),n=o,l=i(s.a,a.a,!1,n,"data-v-721487ec",null);t.default=l.exports}});
//# sourceMappingURL=161.1fb2b05233b4f4e0a660.js.map