webpackJsonp([130],{1483:function(a,i,e){var t=e(1484);"string"==typeof t&&(t=[[a.i,t,""]]),t.locals&&(a.exports=t.locals);e(456)("3127ddc2",t,!0,{})},1484:function(a,i,e){i=a.exports=e(455)(!0),i.push([a.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroPortabilidad.vue",sourceRoot:""}])},1485:function(a,i,e){"use strict";var t=function(){var a=this,i=a.$createElement,e=a._self._c||i;return e("div",[e("v-card",{ref:"formPortabilidad"},[e("v-toolbar",{staticClass:"grey lighten-3 elevation-0 toolbar--dense"},[e("v-toolbar-title",[a._v(" "+a._s(a.tapTitulo)+" ")])],1),a._v(" "),e("v-container",{staticStyle:{"max-width":"inherit"},attrs:{"grid-list-md":""}},[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{attrs:{xs12:"",sm12:"",md12:"",lg12:""}},[e("v-form",{attrs:{"data-vv-scope":"formPortabilidades"}},[e("v-container",{attrs:{fluid:"","grid-list-md":""}},[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{staticClass:"pb-4",attrs:{xs12:""}},[e("v-card",[e("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[e("v-toolbar-title",{staticClass:"subheading"},[e("v-icon",[a._v("assignment")]),a._v(" Portabilidad")],1)],1),a._v(" "),e("v-card-text",[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-menu",{ref:"menuDateSolicitud",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","max-width":"290px","min-width":"290px"},model:{value:a.menuDateSolicitud,callback:function(i){a.menuDateSolicitud=i},expression:"menuDateSolicitud"}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY/MM/DD",expression:"'required|date_format:YYYY/MM/DD'"}],attrs:{slot:"activator",label:"Fecha solicitud","prepend-icon":"event",readonly:"",name:"fecha solicitud","error-messages":a.errors.collect("fecha solicitud")},slot:"activator",model:{value:a.computedDateFormattedSolicitud,callback:function(i){a.computedDateFormattedSolicitud=i},expression:"computedDateFormattedSolicitud"}}),a._v(" "),e("v-date-picker",{attrs:{locale:"es","no-title":""},on:{input:function(i){a.menuDateSolicitud=!1},change:function(){var i=a.$validator.errors.items.findIndex(function(a){return"fecha solicitud"===a.field});a.$validator.errors.items.splice(-1!==i?i:0,-1!==i?1:0)}},model:{value:a.portabilidad.fecha_solicitud,callback:function(i){a.$set(a.portabilidad,"fecha_solicitud",i)},expression:"portabilidad.fecha_solicitud"}})],1)],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-menu",{ref:"menuDateInicio",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","max-width":"290px","min-width":"290px"},model:{value:a.menuDateInicio,callback:function(i){a.menuDateInicio=i},expression:"menuDateInicio"}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY/MM/DD",expression:"'required|date_format:YYYY/MM/DD'"}],attrs:{slot:"activator",label:"Fecha inicio portabilidad","prepend-icon":"event",readonly:"",name:"inicio portabilidad",required:"","data-vv-delay":"1000","error-messages":a.errors.collect("inicio portabilidad")},slot:"activator",model:{value:a.computedDateFormattedInicio,callback:function(i){a.computedDateFormattedInicio=i},expression:"computedDateFormattedInicio"}}),a._v(" "),e("v-date-picker",{attrs:{locale:"es","no-title":""},on:{input:function(i){a.menuDateInicio=!1}},model:{value:a.portabilidad.fecha_inicio,callback:function(i){a.$set(a.portabilidad,"fecha_inicio",i)},expression:"portabilidad.fecha_inicio"}})],1)],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-menu",{ref:"menuDateFinalizacion",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","max-width":"290px","min-width":"290px"},model:{value:a.menuDateFinalizacion,callback:function(i){a.menuDateFinalizacion=i},expression:"menuDateFinalizacion"}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY/MM/DD",expression:"'required|date_format:YYYY/MM/DD'"}],attrs:{slot:"activator",label:"Fecha finalización","prepend-icon":"event",readonly:"",name:"fecha finalización",required:"","error-messages":a.errors.collect("fecha finalización")},slot:"activator",model:{value:a.computedDateFormattedFinalizacion,callback:function(i){a.computedDateFormattedFinalizacion=i},expression:"computedDateFormattedFinalizacion"}}),a._v(" "),e("v-date-picker",{attrs:{locale:"es","no-title":""},on:{input:function(i){a.menuDateFinalizacion=!1},change:function(){var i=a.$validator.errors.items.findIndex(function(a){return"fecha finalización"===a.field});a.$validator.errors.items.splice(-1!==i?i:0,-1!==i?1:0)}},model:{value:a.portabilidad.fecha_fin,callback:function(i){a.$set(a.portabilidad,"fecha_fin",i)},expression:"portabilidad.fecha_fin"}})],1)],1)],1)],1)],1)],1),a._v(" "),e("v-flex",{staticClass:"pb-4",attrs:{xs12:""}},[e("v-card",[e("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[e("v-toolbar-title",{staticClass:"subheading"},[e("v-icon",[a._v("person")]),a._v(" Información Básica")],1)],1),a._v(" "),e("v-card-text",[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{attrs:{xs12:"",sm8:""}},[e("postulador-v2",{directives:[{name:"validate",rawName:"v-validate",value:"required|afiliadoPortable",expression:"'required|afiliadoPortable'"}],attrs:{"no-data":"Busqueda por nombre o número de documento.",hint:"identificacion_completa","item-text":"nombre_completo","data-title":"identificacion_completa","data-subtitle":"nombre_completo",label:"Afiliado",entidad:"afiliados",preicon:"person",name:"Afiliado",rules:"required|afiliadoPortable","error-messages":a.errors.collect("Afiliado"),"slot-append":{template:'<span class="pt-2 caption">Estado: {{value.estado_afiliado.codigo}} - {{value.estado_afiliado.nombre}}</span>',props:["value"]},"slot-prepend":a.portabilidad.afiliado?{template:'<mini-card-detail :data="value.mini_afiliado" alone-icon/>',props:["value"]}:null,"no-btn-edit":"",clearable:""},on:{changeid:function(i){return a.portabilidad.as_afiliado_id=i}},model:{value:a.portabilidad.afiliado,callback:function(i){a.$set(a.portabilidad,"afiliado",i)},expression:"portabilidad.afiliado"}})],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm4:""}},[e("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Municipio receptor",items:a.complementosMunicipios.municipios,"item-value":"id","item-text":"nombre",name:"municipio",required:"","error-messages":a.errors.collect("municipio"),filter:a.filterMunicipios},scopedSlots:a._u([{key:"item",fn:function(i){return[[e("v-list-tile-content",[e("v-list-tile-title",{domProps:{innerHTML:a._s(i.item.nombre)}}),a._v(" "),e("v-list-tile-sub-title",{domProps:{innerHTML:a._s(i.item.nombre_departamento)}})],1)]]}}]),model:{value:a.portabilidad.munreceptor_id,callback:function(i){a.$set(a.portabilidad,"munreceptor_id",i)},expression:"portabilidad.munreceptor_id"}})],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm3:""}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"nueva dirección",attrs:{label:"Nueva Dirección",required:"",name:"nueva dirección",required:"","error-messages":a.errors.collect("nueva dirección")},model:{value:a.portabilidad.direccion,callback:function(i){a.$set(a.portabilidad,"direccion",i)},expression:"portabilidad.direccion"}})],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm3:""}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"teléfono",attrs:{label:"Nuevo Teléfono",name:"nuevo teléfono",required:"","error-messages":a.errors.collect("nuevo teléfono")},model:{value:a.portabilidad.telefono,callback:function(i){a.$set(a.portabilidad,"telefono",i)},expression:"portabilidad.telefono"}})],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm3:""}},[e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"email",expression:"'email'"}],key:"correo electrónico",attrs:{label:"Correo Electrónico",name:"correo electrónico","error-messages":a.errors.collect("correo electrónico")},model:{value:a.portabilidad.email,callback:function(i){a.$set(a.portabilidad,"email",i)},expression:"portabilidad.email"}})],1),a._v(" "),e("v-flex",{attrs:{xs12:"",sm3:""}},[e("v-layout",{attrs:{"align-center":"","fill-height":""}},[e("v-flex",{attrs:{"d-flex":"",xs10:"",sm8:""}},[e("input-file",{ref:"archivoAdjunto",staticClass:"mb-3",attrs:{label:"Carta solicitud","file-name":a.portabilidad.archivo?a.portabilidad.archivo.nombre:null,accept:"application/pdf",hint:"Extenciones aceptadas: pdf","prepend-icon":"attach_file"},model:{value:a.portabilidad.archivo,callback:function(i){a.$set(a.portabilidad,"archivo",i)},expression:"portabilidad.archivo"}})],1),a._v(" "),a.portabilidad.archivo&&a.portabilidad.archivo.url_signed?e("v-flex",{attrs:{"d-flex":"",xs2:"",sm4:""}},[e("v-tooltip",{attrs:{bottom:""}},[e("v-btn",{attrs:{slot:"activator",fab:"",color:"success",small:"",href:a.portabilidad.archivo?a.portabilidad.archivo.url_signed:"",target:"_blank"},slot:"activator"},[e("v-icon",[a._v("remove_red_eye")])],1),a._v(" "),e("span",[a._v("Ver archivo")])],1)],1):a._e()],1)],1),a._v(" "),e("v-flex",{staticClass:"pt-1",attrs:{xs12:"",sm12:"",md12:""}},[e("v-textarea",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"motivo",attrs:{label:"Motivo",name:"motivo","error-messages":a.errors.collect("motivo"),rows:"1","auto-grow":""},model:{value:a.portabilidad.motivo,callback:function(i){a.$set(a.portabilidad,"motivo",i)},expression:"portabilidad.motivo"}})],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1),a._v(" "),e("v-divider"),a._v(" "),e("v-card-actions",{staticClass:"grey lighten-4"},[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{staticClass:"text-xs-left",attrs:{xs6:""}},[e("v-btn",{attrs:{loading:a.loadingSubmit},on:{click:a.formReset}},[a._v("Limpiar")])],1),a._v(" "),e("v-flex",{staticClass:"text-xs-right",attrs:{xs6:""}},[e("v-btn",{on:{click:function(i){return a.close()}}},[a._v("Cancelar")]),a._v(" "),e("v-btn",{attrs:{color:"primary",loading:a.loadingSubmit,disabled:a.errors.any()},on:{click:function(i){return i.preventDefault(),a.submit(i)}}},[a._v("Guardar")])],1)],1)],1)],1)],1)},o=[],r={render:t,staticRenderFns:o};i.a=r},485:function(a,i,e){"use strict";function t(a){e(1483)}Object.defineProperty(i,"__esModule",{value:!0});var o=e(960),r=e(1485),n=e(1),l=t,d=n(o.a,r.a,!1,l,"data-v-977d56c4",null);i.default=d.exports},960:function(a,i,e){"use strict";var t=e(13),o=e.n(t),r=e(14),n=e.n(r),l=e(249),d=e.n(l),s=e(7),c=e.n(s),u=e(23),m=e.n(u),p=e(12),v=e(59),f=e(40),b=e(248),h=e(251);i.a={name:"RegistroPortabilidad",props:["parametros"],components:{PostuladorV2:function(){return new Promise(function(a){a()}).then(e.bind(null,61))},InputFile:function(){return e.e(288).then(e.bind(null,748))}},data:function(){return{detalleAfiliado:function(){return e.e(290).then(e.bind(null,750))},portabilidad:{},portabilidades:[],menuDateSolicitud:!1,menuDateInicio:!1,menuDateFinalizacion:!1,loadingSubmit:!1,payload:null}},beforeMount:function(){var a=this;h.a.extend("afiliadoPortable",{validate:function(i){return new m.a(function(e){function t(a,i){return a>=i.fecha_inicio&&a<=i.fecha_fin}if(null!==i&&void 0!==i&&""!==i){var o=void 0,r=a.moment().format("YYYY-MM-DD"),n=a.portabilidades.filter(function(a){return a.id_afiliado===i.id&&t(r,a)&&"Aceptado"===a.estado});return o=a.portabilidades.filter(function(a){return a.id_afiliado===i.id&&t(r,a)&&"Registrado"===a.estado}).length?{valido:!1,mensaje:"El afiliado cuenta con una solicitud de portabilidad en la fecha actual."}:n.length?{valido:!1,mensaje:"El afiliado cuenta con una portabilidad aceptada en la fecha actual."}:{valido:!0,mensaje:null},e({valid:o.valido,data:{message:o.mensaje}})}})},getMessage:function(a,i,e){return e.message}}),this.formReset()},mounted:function(){null!==this.parametros.entidad&&this.getRegisto(this.parametros.entidad.id),this.getAllPortabilidades()},computed:{tapTitulo:function(){return this.portabilidad.id?"Edición de : "+this.portabilidad.id:"Nuevo Item"},computedDateFormattedSolicitud:function(){return this.formDate(this.portabilidad.fecha_solicitud)},computedDateFormattedInicio:function(){return this.formDate(this.portabilidad.fecha_inicio)},computedDateFormattedFinalizacion:function(){return this.formDate(this.portabilidad.fecha_fin)},complementosMunicipios:function(){return JSON.parse(c()(v.b.getters.complementosTercerosFormBasicos))}},methods:{getAllPortabilidades:function(){var a=this;this.axios.get("portabilidades").then(function(i){console.log("response",i),a.portabilidades=i.data.data}).catch(function(){a.$store.commit(p.b,{msg:"Hay error al traer las portabilidades. ",color:"danger"})})},getRegisto:function(a){var i=this,e=this.$loading.show({container:this.$refs.formPortabilidad.$el});this.axios.get("portabilidades/"+a).then(function(a){""!==a.data&&(i.portabilidad=a.data.data),e.hide()}).catch(function(a){e.hide(),i.$store.commit(p.b,{msg:"Hay un error al traer la portabilidad. "+a.response,color:"danger"})})},formReset:function(){this.portabilidad={id:null,as_afiliado_id:null,fecha_solicitud:null,fecha_inicio:null,fecha_fin:null,munreceptor_id:null,direccion:null,telefono:null,archivo:null,motivo:null,email:null},this.$validator.reset()},addFormData:function(){var a=new FormData;a.append("id",this.portabilidad.id),a.append("as_afiliado_id",this.portabilidad.as_afiliado_id),a.append("fecha_solicitud",this.portabilidad.fecha_solicitud),a.append("fecha_inicio",this.portabilidad.fecha_inicio),a.append("fecha_fin",this.portabilidad.fecha_fin),a.append("munreceptor_id",this.portabilidad.munreceptor_id),a.append("direccion",this.portabilidad.direccion),a.append("telefono",this.portabilidad.telefono),a.append("email",this.portabilidad.email),a.append("motivo",this.portabilidad.motivo),a.append("archivo",void 0===this.portabilidad.archivo?"":this.portabilidad.archivo),this.payload=a},validador:function(a){return this.$validator.validateAll(a).then(function(a){return a})},formDate:function(a){if(!a)return null;var i=a.split("-"),e=d()(i,3);return e[0]+"/"+e[1]+"/"+e[2]},filterMunicipios:function(a,i){var e=function(a){return null!=a?a:""},t=e(a.nombre+" "+a.nombre_departamento),o=e(i);return t.toString().toLowerCase().indexOf(o.toString().toLowerCase())>-1},close:function(){this.formReset(),this.$validator.reset(),this.$store.dispatch(f.c,{contexto:this,itemId:this.parametros.tabOrigin})},submit:function(){var a=this;return n()(o.a.mark(function i(){var e,t;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.validador("formPortabilidades");case 2:if(!i.sent){i.next=10;break}a.loadingSubmit=!0,a.addFormData(),e=a.portabilidad.id?"editar":"crear",t=a.portabilidad.id?a.axios.post("portabilidades/"+a.portabilidad.id,null!==a.portabilidad.archivo?a.payload:a.portabilidad):a.axios.post("portabilidades",null!==a.portabilidad.archivo?a.payload:a.portabilidad),t.then(function(i){a.$store.commit(p.b,{msg:"Se "+(a.portabilidad.id?"actualizaron los datos":"realizó el registro correctamente"),color:"success"}),a.$store.commit(b._5,{item:i.data.portabilidad_o,estado:e,key:a.parametros.key}),a.$store.dispatch(f.c,{contexto:a,itemId:a.parametros.tabOrigin})}).catch(function(i){a.loadingSubmit=!1,a.$store.commit(p.b,{msg:"Hay un error al guardar el registro. "+i,color:"danger"})}),i.next=11;break;case 10:a.$store.commit(p.b,{msg:"Los campos no pueden estar vacios.",color:"danger"});case 11:case"end":return i.stop()}},i,a)}))()}}}}});
//# sourceMappingURL=130.1510fa5fee5e40dd2879.js.map