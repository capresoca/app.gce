webpackJsonp([225],{1176:function(e,a,t){"use strict";var n=t(13),i=t.n(n),o=t(14),r=t.n(o),s=t(23),c=t.n(s),l=t(249),u=t.n(l),d=t(7),g=t.n(d),v=t(12),f=t(251),p=t(58);a.a={name:"Encargos",components:{PostuladorV2:function(){return new Promise(function(e){e()}).then(t.bind(null,61))},ToolbarList:function(){return new Promise(function(e){e()}).then(t.bind(null,247))},Loading:p.default},data:function(){return{encargos:[],encargo:{},tiposEncargo:["Representante Legal","Jefe de Presupuesto","Jefe Financiero"],fechaInicio:null,fechaFin:null,menuDateInicio:!1,menuDateFin:!1,search:"",dialog:!1,loadingSubmit:!1,tableLoading:!1,items_page:[{text:15,value:15},{text:50,value:50},{text:100,value:100}],pagination:{per_page:15,current_page:1},headers:[{text:"Id",align:"left",sortable:!1,value:"id"},{text:"Fecha inicio",align:"left",sortable:!1,value:"fechaInicio"},{text:"Fecha fin",align:"left",sortable:!1,value:"fechaFin"},{text:"Días encargo",align:"left",sortable:!1,value:"diasEncargo"},{text:"Usuario",align:"left",sortable:!1,value:"usuario"},{text:"Tipo",align:"left",sortable:!1,value:"tipo"},{text:"Opciones",align:"left",sortable:!1,value:"id"}]}},beforeMount:function(){this.validadorRangoFecha(),this.validadorRangoTipo()},created:function(){this.formReset(),this.reloadPage()},watch:{"pagination.per_page":function(e){this.pagination.current_page=1,this.reloadPage()}},computed:{validarUsuarioFecha:function(){var e=this;return this.encargos.filter(function(a){return a.gs_usuario_id===e.encargo.gs_usuario_id}).filter(function(a){if(null==e.encargo.id||e.encargo.id!==a.id)return a}).some(this.estaEnRangoDeFecha)},modalTitulo:function(){return this.encargo.id?"Edición del encargo: "+this.encargo.id:"Nuevo encargo"},infoComponent:function(){return this.$store.getters.getInfoComponent("encargos")},computedDateFormattedFechaInicio:function(){return this.formDate(this.encargo.fecha_inicio)},computedDateFormattedFechaFin:function(){return this.formDate(this.encargo.fecha_fin)},pages:function(){return null==this.pagination.rowsPerPage||null==this.pagination.totalItems?0:Math.ceil(this.pagination.totalItems/this.pagination.rowsPerPage)}},methods:{reloadPage:function(){var e=this;this.tableLoading=!0,this.axios.get("th_encargos?per_page="+this.pagination.per_page+"&page="+this.pagination.current_page+"&search=%25"+this.search+"%25").then(function(a){a.data.meta.per_page=e.items_page.find(function(e){return e.value===parseInt(a.data.meta.per_page)})?parseInt(a.data.meta.per_page):-1,e.pagination=a.data.meta,e.encargos=a.data.data,e.tableLoading=!1}).catch(function(a){return e.tableLoading=!1,console.log("Hay un error. "+a),!1})},buscar:window.lodash.debounce(function(){this.pagination.current_page=1,this.reloadPage()},500),estaEnRangoDeFecha:function(e){return this.moment(this.encargo.fecha_inicio).isBetween(e.fecha_inicio,e.fecha_fin,null,"[]")},estaTipoEnRangoDeFecha:function(e){return this.moment(this.encargo.fecha_inicio).isBetween(e.fecha_inicio,e.fecha_fin,null,"[]")},formReset:function(){this.encargo={id:"",concepto_encargo:null,tipo_encargo:null,fecha_fin:null,fecha_inicio:null,gs_usuario_id:null,usuario:null,estado:1}},edit:function(e){this.dialog=!0,this.encargo=JSON.parse(g()(e))},formDate:function(e){if(!e)return null;var a=e.split("-"),t=u()(a,3);return t[0]+"/"+t[1]+"/"+t[2]},openDialog:function(){this.dialog=!0,this.formReset()},close:function(){this.dialog=!1,this.loadingSubmit=!1,this.formReset(),this.$validator.reset()},validadorRangoFecha:function(){f.a.extend("rangoValido",{validate:function(e,a){return new c.a(function(t){console.log("Value",e),console.log("Prop",a);var n={};if(null!==e&&void 0!==e&&""!==e)return n="true"===a[0]?{valido:!1,mensaje:"El usuario ya ha sido asignado en este rango de fecha"}:{valido:!0,mensaje:null},t({valid:n.valido,data:{message:n.mensaje}})})},getMessage:function(e,a,t){return t.message}})},validadorRangoTipo:function(){var e=this;f.a.extend("tipoValido",{validate:function(a,t){return new c.a(function(t){var n={};if(null!==a&&void 0!==a&&""!==a){return n=e.encargos.filter(function(a){return a.tipo_encargo===e.encargo.tipo_encargo}).filter(function(a){if(null==e.encargo.id||e.encargo.id!==a.id)return a}).some(e.estaTipoEnRangoDeFecha)?{valido:!1,mensaje:"El tipo ya ha sido asignado en este rango de fecha"}:{valido:!0,mensaje:null},t({valid:n.valido,data:{message:n.mensaje}})}})},getMessage:function(e,a,t){return t.message}})},validador:function(e){return this.$validator.validateAll(e).then(function(e){return e})},save:function(){var e=this;return r()(i.a.mark(function a(){var t;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.validador("formEncargos");case 2:if(!a.sent){a.next=8;break}e.loadingSubmit=!0,t=e.encargo.id?e.axios.put("th_encargos/"+e.encargo.id,e.encargo):e.axios.post("th_encargos",e.encargo),t.then(function(a){e.encargo.id?(e.$store.commit(v.b,{msg:"El encargo se actualizó correctamente",color:"success"}),e.encargos.splice(e.encargos.findIndex(function(e){return e.id===a.data.data.id}),1,a.data.data)):(e.$store.commit(v.b,{msg:"El encargo se creó correctamente",color:"success"}),e.encargos.splice(0,0,a.data.data)),e.close()}).catch(function(a){e.loadingSubmit=!1,e.$store.commit(v.a,{expression:" al hacer la busqueda de registros. ",error:a})}),a.next=9;break;case 8:e.$store.commit(v.b,{msg:"Los campos no pueden estar vacios.",color:"danger"});case 9:case"end":return a.stop()}},a,e)}))()}}}},2097:function(e,a,t){var n=t(2098);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);t(456)("5858d786",n,!0,{})},2098:function(e,a,t){a=e.exports=t(455)(!0),a.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"Encargos.vue",sourceRoot:""}])},2099:function(e,a,t){"use strict";var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("v-dialog",{attrs:{width:"500px",persistent:""},model:{value:e.dialog,callback:function(a){e.dialog=a},expression:"dialog"}},[t("v-form",{attrs:{"data-vv-scope":"formEncargos"}},[t("v-card",[t("v-card-title",{staticClass:"grey lighten-3 elevation-0"},[t("span",{staticClass:"title"},[e._v(e._s(e.modalTitulo))])]),e._v(" "),t("v-container",{attrs:{fluid:"","grid-list-md":""}},[t("v-layout",{attrs:{row:"",wrap:""}},[t("v-flex",{attrs:{xs12:"",sm6:""}},[t("v-menu",{ref:"menuDateInicio",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","max-width":"290px","min-width":"290px"},model:{value:e.menuDateInicio,callback:function(a){e.menuDateInicio=a},expression:"menuDateInicio"}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY/MM/DD",expression:"'required|date_format:YYYY/MM/DD'"}],attrs:{slot:"activator",label:"Fecha inicio","prepend-icon":"event",readonly:"",name:"fecha inicio","error-messages":e.errors.collect("fecha inicio")},slot:"activator",model:{value:e.computedDateFormattedFechaInicio,callback:function(a){e.computedDateFormattedFechaInicio=a},expression:"computedDateFormattedFechaInicio"}}),e._v(" "),t("v-date-picker",{attrs:{locale:"es","no-title":""},on:{input:function(a){e.menuDateInicio=!1},change:function(){var a=e.$validator.errors.items.findIndex(function(e){return"fecha inicio"===e.field});e.$validator.errors.items.splice(-1!==a?a:0,-1!==a?1:0)}},model:{value:e.encargo.fecha_inicio,callback:function(a){e.$set(e.encargo,"fecha_inicio",a)},expression:"encargo.fecha_inicio"}})],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm6:""}},[t("v-menu",{ref:"menuDateInicio",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","max-width":"290px","min-width":"290px"},model:{value:e.menuDateFin,callback:function(a){e.menuDateFin=a},expression:"menuDateFin"}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY/MM/DD",expression:"'required|date_format:YYYY/MM/DD'"}],attrs:{slot:"activator",label:"Fecha fin","prepend-icon":"event",readonly:"",name:"fecha fin",required:"","data-vv-delay":"1000","error-messages":e.errors.collect("fecha fin")},slot:"activator",model:{value:e.computedDateFormattedFechaFin,callback:function(a){e.computedDateFormattedFechaFin=a},expression:"computedDateFormattedFechaFin"}}),e._v(" "),t("v-date-picker",{attrs:{locale:"es","no-title":""},on:{input:function(a){e.menuDateFin=!1}},model:{value:e.encargo.fecha_fin,callback:function(a){e.$set(e.encargo,"fecha_fin",a)},expression:"encargo.fecha_fin"}})],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:""}},[t("postulador-v2",{directives:[{name:"validate",rawName:"v-validate",value:"required|rangoValido:"+e.validarUsuarioFecha,expression:"'required|rangoValido:' + validarUsuarioFecha"}],attrs:{"no-data":"Busqueda por nombre o número de documento.",hint:"email","item-text":"name","data-title":"email","data-subtitle":"name",filter:"name,identification,email",label:"Usuario",entidad:"usuarios",preicon:"person",name:"usuario",rules:"required","error-messages":e.errors.collect("usuario"),"no-btn-edit":""},on:{changeid:function(a){return e.encargo.gs_usuario_id=a}},model:{value:e.encargo.usuario,callback:function(a){e.$set(e.encargo,"usuario",a)},expression:"encargo.usuario"}})],1),e._v(" "),t("v-flex",{attrs:{xs12:""}},[t("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required|tipoValido",expression:"'required|tipoValido'"}],attrs:{items:e.tiposEncargo,label:"Tipo",name:"tipo","prepend-icon":"input","error-messages":e.errors.collect("tipo"),required:""},model:{value:e.encargo.tipo_encargo,callback:function(a){e.$set(e.encargo,"tipo_encargo",a)},expression:"encargo.tipo_encargo"}})],1),e._v(" "),t("v-flex",{attrs:{xs12:""}},[t("v-textarea",{attrs:{outline:"",name:"observacion",label:"Observación"},model:{value:e.encargo.concepto_encargo,callback:function(a){e.$set(e.encargo,"concepto_encargo",a)},expression:"encargo.concepto_encargo"}})],1),e._v(" "),t("v-flex",{attrs:{xs12:""}},[t("v-subheader",{staticClass:"pa-0 ma-0"},[e._v("Estado")]),e._v(" "),t("v-switch",{staticClass:"ma-0 pa-0",attrs:{color:"accent","true-value":1,"false-value":0},model:{value:e.encargo.estado,callback:function(a){e.$set(e.encargo,"estado",a)},expression:"encargo.estado"}})],1)],1)],1),e._v(" "),t("v-card-actions",{staticClass:"grey lighten-4"},[t("v-spacer"),e._v(" "),t("v-btn",{on:{click:e.close}},[e._v("Cancelar")]),e._v(" "),t("v-btn",{attrs:{color:"primary",loading:e.loadingSubmit},on:{click:e.save}},[e._v("Guardar")])],1)],1)],1)],1),e._v(" "),t("v-card",[t("toolbar-list",{attrs:{info:e.infoComponent,title:"Encargos",subtitle:"Registro y gestión",btnplus:"",btnplustitle:"Crear encargo",btnplustruncate:""},on:{click:e.openDialog}}),e._v(" "),t("loading",{model:{value:e.tableLoading,callback:function(a){e.tableLoading=a},expression:"tableLoading"}}),e._v(" "),t("v-container",{attrs:{fluid:""}},[t("v-layout",{attrs:{row:"",wrap:""}},[t("v-flex",{staticClass:"text-xs-right",attrs:{xs1:"",sm3:"",md6:""}},[t("v-tooltip",{attrs:{top:""}},[t("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"accent"},on:{click:e.reloadPage},slot:"activator"},[t("v-icon",[e._v("cached")])],1),e._v(" "),t("span",[e._v("Actualizar registros")])],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm3:"",md2:""}},[t("v-select",{attrs:{label:"Registros por página",items:e.items_page,"item-text":"text","item-value":"value"},model:{value:e.pagination.per_page,callback:function(a){e.$set(e.pagination,"per_page",a)},expression:"pagination.per_page"}})],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[t("v-text-field",{attrs:{"append-icon":"search",label:"Buscar"},on:{input:e.buscar},model:{value:e.search,callback:function(a){e.search=a},expression:"search"}})],1)],1),e._v(" "),t("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.encargos,loading:e.tableLoading,pagination:e.pagination,"total-items":e.encargos.length,search:e.search,"hide-actions":""},on:{"update:pagination":function(a){e.pagination=a}},scopedSlots:e._u([{key:"items",fn:function(a){return[t("td",[e._v(e._s(a.item.id))]),e._v(" "),t("td",[e._v(e._s(a.item.fecha_inicio))]),e._v(" "),t("td",[e._v(e._s(a.item.fecha_fin))]),e._v(" "),t("td",[t("v-chip",{attrs:{color:"primary","text-color":"white"}},[e._v(e._s(a.item.diferencia_dias))])],1),e._v(" "),t("td",[e._v(e._s(a.item.usuario?a.item.usuario.name:"No registra"))]),e._v(" "),t("td",[e._v(e._s(a.item.tipo_encargo))]),e._v(" "),t("td",["Finalizado"!==a.item.diferencia_dias?t("v-speed-dial",{attrs:{direction:"left","open-on-hover":"",transition:"slide-x-transition"},model:{value:a.item.show,callback:function(t){e.$set(a.item,"show",t)},expression:"props.item.show"}},[t("v-btn",{attrs:{slot:"activator",color:"blue darken-2",dark:"",fab:"",small:""},slot:"activator",model:{value:a.item.show,callback:function(t){e.$set(a.item,"show",t)},expression:"props.item.show"}},[t("v-icon",[e._v("chevron_left")]),e._v(" "),t("v-icon",[e._v("close")])],1),e._v(" "),t("v-tooltip",{attrs:{top:""}},[t("v-btn",{attrs:{slot:"activator",fab:"",dark:"",small:"",color:"white"},on:{click:function(t){return e.edit(a.item)}},slot:"activator"},[t("v-icon",{attrs:{color:"accent"}},[e._v("mode_edit")])],1),e._v(" "),t("span",[e._v("Editar")])],1)],1):e._e()],1)]}}])},[e._v(" "),t("template",{slot:"no-data"},[e.tableLoading?t("v-alert",{attrs:{value:!0,color:"info",icon:"info"}},[e._v("\n            Estamos cargando los registros. "),t("v-icon",[e._v("sentiment_satisfied_alt")])],1):t("v-alert",{attrs:{value:!0,color:"error",icon:"warning"}},[e._v("\n            Lo sentimos, no tenemos registros para mostrar. "),t("v-icon",[e._v("sentiment_very_dissatisfied")])],1)],1),e._v(" "),t("template",{slot:"footer"},[t("td",{staticClass:"text-xs-center",attrs:{colspan:"100%"}},[t("v-pagination",{attrs:{"total-visible":7,length:e.pagination.last_page},on:{input:e.reloadPage},model:{value:e.pagination.current_page,callback:function(a){e.$set(e.pagination,"current_page",a)},expression:"pagination.current_page"}})],1)])],2)],1)],1)],1)},i=[],o={render:n,staticRenderFns:i};a.a=o},631:function(e,a,t){"use strict";function n(e){t(2097)}Object.defineProperty(a,"__esModule",{value:!0});var i=t(1176),o=t(2099),r=t(1),s=n,c=r(i.a,o.a,!1,s,"data-v-17389ef0",null);a.default=c.exports}});
//# sourceMappingURL=225.f77b1b4392a63e856812.js.map