webpackJsonp([43],{1073:function(e,i,t){"use strict";var a=t(23),r=t.n(a),o=t(7),n=t.n(o),s=t(13),d=t.n(s),l=t(14),c=t.n(l),u=t(12),m=t(40),v=t(248),f=t(1821),p=t(59),h=t(251);i.a={name:"RegistroUsuario",props:["parametros"],components:{SelectorEntidad:f.a,PostuladorV2:function(){return new Promise(function(e){e()}).then(t.bind(null,61))}},data:function(){return{isEditing:!1,usuario:{id:null,identification:null,name:null,email:null,password:null,phone:null,state:"Activo",tipo:null,rs_entidad_id:null,roles:[]},listaRoles:[],verified:!1,verifiedEmail:!1,loadingSubmit:!1,emailVerifiedIcon:"done",identificacionVerifiedIcon:"done"}},computed:{validacionIdentificacion:function(){return this.verified},validacionEmail:function(){return this.verifiedEmail},tapTitulo:function(){return this.usuario.id?"Edición del usuario: "+this.usuario.name+"("+this.usuario.email+")":"Nuevo usuario"},tiposUsuarios:function(){return p.b.getters.complementosFormUsuario}},watch:{verified:function(e){e||this.$validator.reset()}},created:function(){this.validadorIdentificacion(),this.validadorEmail()},mounted:function(){this.refresh(),this.formReset(),this.getRoles(),null!==this.parametros.entidad&&this.getRegisto(this.parametros.entidad.id)},methods:{getRegisto:function(e){var i=this,t=this.$loading.show({container:this.$refs.formUsuario.$el});this.axios.get("usuarios/"+e).then(function(e){""!==e.data&&(i.usuario=e.data.data),t.hide()}).catch(function(e){t.hide(),i.$store.commit(u.b,{msg:"Hay un error al traer el usuario. "+e.response,color:"danger"})})},verificarIdentificacion:function(){var e=this;return c()(d.a.mark(function i(){return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!e.usuario.identification){i.next=3;break}return i.next=3,e.axios.get("usuarios/identificacion/"+e.usuario.identification).then(function(i){e.verified=i.data.exists,e.verified?e.identificacionVerifiedIcon="done":e.identificacionVerifiedIcon="done_all"}).catch(function(i){e.$store.commit(u.b,{msg:"Error al realizar la validación",color:"danger"})});case 3:case"end":return i.stop()}},i,e)}))()},verificarEmail:function(){var e=this;return c()(d.a.mark(function i(){return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!e.usuario.email){i.next=3;break}return i.next=3,e.axios.get("usuarios/email/"+e.usuario.email).then(function(i){e.verifiedEmail=i.data.exists,e.verifiedEmail?e.emailVerifiedIcon="done":e.emailVerifiedIcon="done_all"}).catch(function(i){e.$store.commit(u.b,{msg:"Error al realizar la validación",color:"danger"})});case 3:case"end":return i.stop()}},i,e)}))()},getRoles:function(){var e=this;this.axios.get("gs_roles").then(function(i){""!==i.data&&(e.listaRoles=i.data.data.roles)}).catch(function(i){e.$store.commit(u.b,{msg:"Hay un error al traer los roles. "+i.response,color:"danger"})})},formReset:function(){this.usuario={id:null,identification:null,name:null,email:null,password:null,phone:null,state:"Activo",tipo:null,rs_entidad_id:null}},close:function(){this.formReset(),this.$validator.reset(),this.$store.dispatch(m.c,{contexto:this,itemId:this.parametros.tabOrigin})},refresh:function(){this.$validator.reset(),this.usuario=JSON.parse(n()(this.usuario))},validadorIdentificacion:function(){h.a.extend("identificacionValida",{validate:function(e,i){return new r.a(function(t){var a={};if(null!==e&&void 0!==e&&""!==e)return a="true"===i[0]?{valido:!1,mensaje:"Ya existe un usuario con esta identificación"}:{valido:!0,mensaje:"Usuario disponible"},t({valid:a.valido,data:{message:a.mensaje}})})},getMessage:function(e,i,t){return t.message}})},validadorEmail:function(){h.a.extend("emailValido",{validate:function(e,i){return new r.a(function(t){var a={};if(null!==e&&void 0!==e&&""!==e)return a="true"===i[0]?{valido:!1,mensaje:"Este email ya se encuentra registrado"}:{valido:!0,mensaje:"Disponible"},t({valid:a.valido,data:{message:a.mensaje}})})},getMessage:function(e,i,t){return t.message}})},validador:function(e){return this.$validator.validateAll(e).then(function(e){return e})},save:function(){var e=this;return c()(d.a.mark(function i(){var t,a;return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.validador("formUsuario");case 2:if(!i.sent){i.next=9;break}e.loadingSubmit=!0,t=e.usuario.id?"editar":"crear",a=e.usuario.id?e.axios.put("usuarios/"+e.usuario.id,e.usuario):e.axios.post("usuarios",e.usuario),a.then(function(i){e.usuario.id?(e.$store.commit(u.b,{msg:"El usuario se actualizó correctamente",color:"success"}),e.$store.commit(v._30,{item:i.data.data,estado:t,key:e.parametros.key})):(e.$store.commit(u.b,{msg:"El usuario se creó correctamente",color:"success"}),e.$store.commit(v._30,{item:i.data.data,estado:t,key:e.parametros.key})),e.dialog=!1,e.close()}).catch(function(i){e.loadingSubmit=!1,e.$store.commit(u.a,{expression:" al guardar usuario ",error:i})}),i.next=10;break;case 9:e.$store.commit(u.b,{msg:"Los campos no pueden estar vacios.",color:"danger"});case 10:case"end":return i.stop()}},i,e)}))()}}}},1074:function(e,i,t){"use strict";var a=t(13),r=t.n(a),o=t(14),n=t.n(o),s=t(59),d=t(12);i.a={name:"Selector",props:["object","label","required","mode","scope"],data:function(){return{entidad:{item:{id:null},items:[],loading:!1,search:null,filter:function(e,i){var t=function(e){return null!=e?e:""},a=t(e.cod_habilitacion+" "+e.tercero.identificacion+" "+e.tercero.nombre_completo),r=t(i);return a.toString().toLowerCase().indexOf(r.toString().toLowerCase())>-1}}}},watch:{"entidad.item":function(e){e&&this.$emit("change",this.typeObject?e.id:e)},"entidad.search":function(e){e&&""!==e&&null!==e&&this.buscar()}},computed:{isRequired:function(){return void 0===this.required},tipdocidentidades:function(){return s.b.getters.complementosTercerosFormBasicos.tipdocidentidades},titleLabel:function(){return void 0===this.label?"entidad":this.label},typeObject:function(){return void 0===this.object}},methods:{reset:function(){this.$validator.reset(),this.entidad.showContent=!1,this.entidad.items=[],this.entidad.search=null,this.entidad.item={id:null}},assign:function(e){this.reset(),this.entidad.item=e,this.entidad.items.push(e)},buscar:window.lodash.debounce(function(){var e=this;this.entidad.loading=!0,this.axios.get("entidades/?rs_tipentidade_id="+this.mode+"&search=%20"+this.entidad.search+"%20").then(function(i){console.log("response.data"),console.log(i.data.data),i.data.data.length>0&&(e.entidad.items=i.data.data),e.entidad.loading=!1,console.log(e.entidad.items)}).catch(function(i){e.entidad.loading=!1,e.$store.commit(d.b,{msg:"Hay un error al hacer la busqueda de entidades. "+i.response,color:"danger"})})},500),validate:function(){var e=this;return n()(r.a.mark(function i(){return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",e.$validator.validateAll(e.scope).then(function(e){return e}));case 1:case"end":return i.stop()}},i,e)}))()}}}},1819:function(e,i,t){var a=t(1820);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);t(456)("0811d75e",a,!0,{})},1820:function(e,i,t){i=e.exports=t(455)(!0),i.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroUsuario.vue",sourceRoot:""}])},1821:function(e,i,t){"use strict";function a(e){t(1822)}var r=t(1074),o=t(1824),n=t(1),s=a,d=n(r.a,o.a,!1,s,"data-v-314c7556",null);i.a=d.exports},1822:function(e,i,t){var a=t(1823);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);t(456)("34d100da",a,!0,{})},1823:function(e,i,t){i=e.exports=t(455)(!0),i.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"Selector.vue",sourceRoot:""}])},1824:function(e,i,t){"use strict";var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:e.isRequired?"":"required",expression:"isRequired ? '' : 'required'"}],attrs:{label:e.entidad.item.id?e.titleLabel:"Buscar "+e.titleLabel,items:e.entidad.items,"item-text":"tercero.nombre_completo",hint:e.entidad.item.id?"Código de habilitación: "+e.entidad.item.cod_habilitacion:"","persistent-hint":"",name:e.titleLabel,required:!e.isRequired,"error-messages":e.errors.collect(e.titleLabel),loading:e.entidad.loading,"search-input":e.entidad.search,filter:e.entidad.filter,"no-data-text":"Busqueda por nombre, NIT o código de habilitación.","return-object":""},on:{"update:searchInput":function(i){return e.$set(e.entidad,"search",i)},"update:search-input":function(i){return e.$set(e.entidad,"search",i)}},scopedSlots:e._u([{key:"item",fn:function(i){return[[t("v-list-tile-content",[t("v-list-tile-title",{domProps:{innerHTML:e._s(i.item.tercero?i.item.tercero.nombre_completo:"")}}),e._v(" "),t("v-list-tile-sub-title",{domProps:{innerHTML:e._s(i.item.tercero?e.tipdocidentidades.find(function(e){return e.id===i.item.tercero.gn_tipdocidentidad_id}).abreviatura+" "+i.item.tercero.identificacion+" - Código de habilitación: "+i.item.cod_habilitacion:"")}})],1)]]}}]),model:{value:e.entidad.item,callback:function(i){e.$set(e.entidad,"item",i)},expression:"entidad.item"}})},r=[],o={render:a,staticRenderFns:r};i.a=o},1825:function(e,i,t){"use strict";var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("v-form",{ref:"formUsuario",attrs:{autocomplete:"off"}},[t("v-card",[t("v-toolbar",{staticClass:"grey lighten-3 elevation-0 toolbar--dense"},[t("v-toolbar-title",[e._v(" "+e._s(e.tapTitulo)+" ")])],1),e._v(" "),t("v-card-text",[t("v-container",{staticStyle:{"max-width":"inherit"},attrs:{"grid-list-md":""}},[t("v-layout",{attrs:{wrap:""}},[t("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[t("v-layout",{staticClass:"pt-2 px-2",attrs:{"align-center":""}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|max:15|identificacionValida:"+e.validacionIdentificacion,expression:"'required|max:15|identificacionValida:' + validacionIdentificacion"}],attrs:{label:"Identificación",name:"Identificación",required:"","error-messages":e.errors.collect("Identificación")},model:{value:e.usuario.identification,callback:function(i){e.$set(e.usuario,"identification",i)},expression:"usuario.identification"}}),e._v(" "),t("v-tooltip",{attrs:{top:""}},[t("v-btn",{attrs:{slot:"activator",disabled:!e.usuario.identification,flat:"",icon:"",color:"accent"},on:{click:e.verificarIdentificacion},slot:"activator"},[t("v-icon",[e._v(e._s(e.identificacionVerifiedIcon))])],1),e._v(" "),t("span",[e._v(e._s(e.verified?"Verificar identificación":"Identificación verificada"))])],1)],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm12:"",md4:""}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"nombre",attrs:{label:"Nombres y Apellidos",name:"nombre",required:"","error-messages":e.errors.collect("nombre")},model:{value:e.usuario.name,callback:function(i){e.$set(e.usuario,"name",i)},expression:"usuario.name"}})],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm12:"",md4:""}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"telefono",attrs:{label:"Telefono",name:"telefono",required:"","error-messages":e.errors.collect("telefono")},model:{value:e.usuario.phone,callback:function(i){e.$set(e.usuario,"phone",i)},expression:"usuario.phone"}})],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm12:"",md4:""}},[t("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{items:e.tiposUsuarios,label:"Tipo de Usuario",name:"tipo","error-messages":e.errors.collect("Tipo"),required:""},model:{value:e.usuario.tipo,callback:function(i){e.$set(e.usuario,"tipo",i)},expression:"usuario.tipo"}})],1),e._v(" "),"Entidad"===e.usuario.tipo?t("v-flex",{attrs:{xs12:"",sm12:"",md8:""}},[t("postulador-v2",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{"no-data":"Busqueda por NIT, razon social u código de habilitación.",hint:"nombre","item-text":"nombre","data-title":"nombre","data-subtitle":"nombre",label:"Entidad",entidad:"entidades",preicon:"location_city",name:"entidad",rules:"required","error-messages":e.errors.collect("entidad"),"no-btn-create":"","min-characters-search":3},on:{changeid:function(i){return e.usuario.rs_entidad_id=i}},model:{value:e.usuario.entidad,callback:function(i){e.$set(e.usuario,"entidad",i)},expression:"usuario.entidad"}})],1):e._e(),e._v(" "),t("v-flex",{attrs:{xs12:"",md4:""}},[t("v-layout",{staticClass:"pt-1 px-2",attrs:{"align-center":""}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|email|emailValido:"+e.validacionEmail,expression:"'required|email|emailValido:' + validacionEmail"}],attrs:{"browser-autocomplete":"false",label:"Correo Electrónico",name:"email",required:"","error-messages":e.errors.collect("email")},model:{value:e.usuario.email,callback:function(i){e.$set(e.usuario,"email",i)},expression:"usuario.email"}}),e._v(" "),t("v-tooltip",{attrs:{top:""}},[t("v-btn",{attrs:{slot:"activator",disabled:!e.usuario.email,flat:"",icon:"",color:"accent"},on:{click:e.verificarEmail},slot:"activator"},[t("v-icon",[e._v(e._s(e.emailVerifiedIcon))])],1),e._v(" "),t("span",[e._v(e._s(e.verifiedEmail?"Verificar correo":"Correo verificado"))])],1)],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:"",sm12:"",md4:""}},[t("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],key:"password",attrs:{"browser-autocomplete":"false",type:"password",label:"Contraseña",name:"Contraseña",required:"",readonly:!e.isEditing,"error-messages":e.errors.collect("contrasena")},model:{value:e.usuario.password,callback:function(i){e.$set(e.usuario,"password",i)},expression:"usuario.password"}},[t("v-slide-x-reverse-transition",{attrs:{slot:"append-outer",mode:"out-in"},slot:"append-outer"},[t("v-icon",{key:"icon-"+e.isEditing,attrs:{color:e.isEditing?"success":"accent"},domProps:{textContent:e._s(e.isEditing?"done":"edit")},on:{click:function(i){e.isEditing=!e.isEditing}}})],1)],1)],1),e._v(" "),"Entidad"!==e.usuario.tipo?t("v-flex",{attrs:{xs12:"",sm12:"",md12:""}},[t("v-select",{staticClass:"v-chips",attrs:{color:"success",items:e.listaRoles,"item-text":"nombre","item-value":"id",label:"Roles",chips:"","return-object":"",multiple:"","deletable-chips":"","small-chips":""},model:{value:e.usuario.roles,callback:function(i){e.$set(e.usuario,"roles",i)},expression:"usuario.roles"}})],1):e._e(),e._v(" "),e.usuario.id?t("v-flex",{attrs:{xs12:"",sm12:"",md12:""}},[t("v-switch",{attrs:{color:"success",label:e.usuario.state,"true-value":"Activo","false-value":"Inactivo"},model:{value:e.usuario.state,callback:function(i){e.$set(e.usuario,"state",i)},expression:"usuario.state"}})],1):e._e()],1)],1)],1),e._v(" "),t("v-divider"),e._v(" "),t("v-card-actions",{staticClass:"grey lighten-4"},[t("v-layout",{attrs:{row:"",wrap:""}},[t("v-flex",{staticClass:"text-xs-left",attrs:{xs6:""}},[t("v-btn",{attrs:{loading:e.loadingSubmit},on:{click:function(i){return e.refresh(null)}}},[e._v("Limpiar")])],1),e._v(" "),t("v-flex",{staticClass:"text-xs-right",attrs:{xs6:""}},[t("v-btn",{on:{click:function(i){return e.close()}}},[e._v("Cancelar")]),e._v(" "),t("v-btn",{attrs:{color:"primary",loading:e.loadingSubmit},on:{click:function(i){return i.preventDefault(),e.save(i)}}},[e._v("Guardar")])],1)],1)],1)],1)],1)},r=[],o={render:a,staticRenderFns:r};i.a=o},556:function(e,i,t){"use strict";function a(e){t(1819)}Object.defineProperty(i,"__esModule",{value:!0});var r=t(1073),o=t(1825),n=t(1),s=a,d=n(r.a,o.a,!1,s,"data-v-0ee06732",null);i.default=d.exports}});
//# sourceMappingURL=43.f3bf78507aac612a8362.js.map