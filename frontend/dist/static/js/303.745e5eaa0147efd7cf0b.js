webpackJsonp([303],{1283:function(a,o,e){"use strict";function s(a){e(2420)}Object.defineProperty(o,"__esModule",{value:!0});var t=e(1284),l=e(2422),i=e(1),r=s,n=i(t.a,l.a,!1,r,"data-v-6ad87e58",null);o.default=n.exports},1284:function(a,o,e){"use strict";var s=e(13),t=e.n(s),l=e(14),i=e.n(l),r=e(7),n=e.n(r);o.a={name:"RegistroGlosa",props:["servicios","glosas","window","capitado","facturaid"],components:{InputNumber:function(){return new Promise(function(a){a()}).then(e.bind(null,254))},Loading:function(){return new Promise(function(a){a()}).then(e.bind(null,58))}},data:function(){return{loading:!1,filterGlosas:function(a,o){var e=function(a){return null!=a?a:""},s=e(a.tipo+" "+a.glosa+" "+a.descripcion),t=e(o);return s.toString().toLowerCase().indexOf(t.toString().toLowerCase())>-1},glosa:null,errorSobreValorado:null,makeGlosa:{id:null,cm_facservicio_id:null,cm_manglosa_id:null,manglosa:null,observacion:null,tipo:null,valor_glosa:null,of_facservicio:null}}},watch:{"servicios.length":function(a){this.glosa.cm_facservicio_id=1===a?this.servicios[0].id:null,this.reloadHintValorGlosa(),this.nuevaGlosa()},"glosa.tipo":function(a){a&&this.reloadHintValorGlosa()},"glosa.manglosa":function(a){a&&(this.glosa.cm_manglosa_id=a.id)},window:function(){this.nuevaGlosa()},"glosa.valor_glosa":function(){this.validacionValorSuperado()},"glosa.of_facservicio":function(){this.validacionValorSuperado()},glosa:function(a){a&&this.capitado&&this.glosa?this.glosa.tipo="Porcentaje":this.glosa.tipo=null}},created:function(){this.nuevaGlosa()},methods:{reloadHintValorGlosa:function(){1===this.servicios.length?this.glosa.valor_glosa="Valor total"===this.glosa.tipo?this.servicios[0].valor_total:null:this.glosa.valor_glosa=null},nuevaGlosa:function(){this.glosa=JSON.parse(n()(this.makeGlosa)),this.glosa.cm_facservicio_id=1===this.servicios.length?this.servicios[0].id:null,this.$validator.reset()},validacionValorSuperado:function(){var a=this;return this.errorSobreValorado="",this.servicios.length&&this.glosa&&this.glosa.valor_glosa&&this.servicios.some(function(o,e){var s=0;return("Porcentaje"!==a.glosa.tipo?a.glosa.valor_glosa:o.valor_total*a.glosa.valor_glosa/100)>o.valor_total?(a.errorSobreValorado="El valor de la glosa no puede ser mayor al valor del servicio, ITEM "+(e+1),!0):(o.glosas.length&&!a.glosa.of_facservicio&&(s=a.lodash.sumBy(o.glosas.filter(function(a){return!a.of_facservicio}),"valor_glosa")),s+="Porcentaje"!==a.glosa.tipo?a.glosa.valor_glosa:o.valor_total*a.glosa.valor_glosa/100,a.errorSobreValorado=s>o.valor_total?"La suma de Ã©sta glosa hace superar el valor glosado del item facturado, ITEM "+(e+1):"",!!a.errorSobreValorado||void 0)}),""===this.errorSobreValorado},validate:function(){var a=this;return i()(t.a.mark(function o(){var e,s;return t.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,a.$validator.validateAll();case 2:return e=o.sent,o.next=5,a.validacionValorSuperado();case 5:return s=o.sent,o.abrupt("return",e&&s);case 7:case"end":return o.stop()}},o,a)}))()},registraGlosa:function(){var a=this;return i()(t.a.mark(function o(){var e;return t.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,a.validate();case 2:if(!o.sent){o.next=7;break}a.loading=!0,console.log("this.servicios",a.servicios),e=a.axios.post(1===a.servicios.length?"facservicios/"+a.glosa.cm_facservicio_id+"/glosa":"facservicios/masivos",1===a.servicios.length?a.glosa:{facservicios:a.servicios.map(function(a){return a.id}),item:"glosa",glosa:a.glosa}),e.then(function(o){1===a.servicios.length&&a.servicios[0].glosas.splice(0,0,o.data.data),a.loading=!1,a.$emit("success"),a.$store.commit("SNACK_SHOW",{msg:"La glosa fue registrada correctamente.",color:"success"})}).catch(function(o){a.loading=!1,a.$store.commit("SNACK_ERROR_LIST",{expression:"al registrar la glosa",error:o})});case 7:case"end":return o.stop()}},o,a)}))()}}}},2420:function(a,o,e){var s=e(2421);"string"==typeof s&&(s=[[a.i,s,""]]),s.locals&&(a.exports=s.locals);e(456)("0901e9de",s,!0,{})},2421:function(a,o,e){o=a.exports=e(455)(!0),o.push([a.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroGlosa.vue",sourceRoot:""}])},2422:function(a,o,e){"use strict";var s=function(){var a=this,o=a.$createElement,e=a._self._c||o;return e("v-card",[e("loading",{model:{value:a.loading,callback:function(o){a.loading=o},expression:"loading"}}),a._v(" "),e("v-card-title",{staticClass:"grey lighten-3 py-2"},[e("span",{staticClass:"font-weight-bold"},[a._v(" Nueva glosa ")])]),a._v(" "),e("v-divider"),a._v(" "),e("v-container",{attrs:{fluid:"","grid-list-md":""}},[e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{attrs:{xs12:""}},[e("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Seleccionar glosa",items:a.glosas.filter(function(o){return o.capita===(a.capitado?"1":"0")}),"item-value":"id","item-text":"descripcion",filter:a.filterGlosas,name:"glosa","error-messages":a.errors.collect("glosa"),"return-object":""},scopedSlots:a._u([{key:"selection",fn:function(o){return[e("div",{staticStyle:{width:"100% !important"}},[e("v-list-tile",{staticClass:"content-v-list-tile-p0"},[e("v-list-tile-content",{staticClass:"truncate-content"},[e("span",{staticClass:"ma-0 body-2"},[a._v(a._s(o.item.glosa)+": "+a._s(o.item.descripcion))]),a._v(" "),e("span",{staticClass:"ma-0 body-2"},[a._v("Tipo: "+a._s(o.item.tipo))])])],1),a._v(" "),e("v-divider")],1)]}},{key:"item",fn:function(o){return[e("div",{staticStyle:{width:"100% !important"}},[e("v-list-tile",{staticClass:"content-v-list-tile-p0"},[e("v-list-tile-content",{staticClass:"truncate-content"},[e("span",{staticClass:"ma-0 body-1"},[a._v(a._s(o.item.glosa)+": "+a._s(o.item.descripcion))]),a._v(" "),e("span",{staticClass:"ma-0 body-1"},[a._v("Tipo: "+a._s(o.item.tipo))])])],1)],1)]}}]),model:{value:a.glosa.manglosa,callback:function(o){a.$set(a.glosa,"manglosa",o)},expression:"glosa.manglosa"}})],1),a._v(" "),a.glosa.manglosa?["Devoluciones"!==a.glosa.manglosa.tipo?[e("v-flex",{attrs:{xs12:"",sm12:"",md8:"Valor total"===a.glosa.tipo||null===a.glosa.tipo,md4:null!==a.glosa.tipo&&"Valor total"!==a.glosa.tipo}},[e("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Tipo","item-value":"value","item-text":"text",items:[{value:"Valor total",text:"Valor total"},{value:"Valor",text:"Valor parcial"},{value:"Porcentaje",text:"Porcentaje"}],name:"Tipo","error-messages":a.errors.collect("Tipo"),"persistent-hint":"",hint:"Valor total"===a.glosa.tipo&&1===a.servicios.length?a.currency(a.glosa.valor_glosa):"",readonly:a.capitado},model:{value:a.glosa.tipo,callback:function(o){a.$set(a.glosa,"tipo",o)},expression:"glosa.tipo"}})],1),a._v(" "),a.glosa.tipo&&"Valor total"!==a.glosa.tipo?e("v-flex",{attrs:{xs12:"",sm8:"",md4:""}},["Valor"===a.glosa.tipo?e("input-number",{directives:[{name:"validate",rawName:"v-validate",value:"required|min_value:0"+(1===a.servicios.length?"|max_value:"+a.servicios[0].valor_total:""),expression:"`required|min_value:0` + (servicios.length === 1 ? `|max_value:${servicios[0].valor_total}` : '') "}],key:"inputValor",attrs:{name:"valor","prepend-icon":"attach_money","error-messages":a.errors.collect("valor")},model:{value:a.glosa.valor_glosa,callback:function(o){a.$set(a.glosa,"valor_glosa",a._n(o))},expression:"glosa.valor_glosa"}}):a._e(),a._v(" "),"Porcentaje"===a.glosa.tipo?e("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|min_value:0|max_value:100",expression:"`required|min_value:0|max_value:100`"}],key:"inputporcentaje",attrs:{label:"Porcentaje",prefix:"%",type:"number",min:"0",max:"100",name:"porcentaje","error-messages":a.errors.collect("porcentaje"),hint:1===a.servicios.length&&a.glosa.valor_glosa?a.currency(a.servicios[0].valor_total*a.glosa.valor_glosa/100):"","persistent-hint":""},model:{value:a.glosa.valor_glosa,callback:function(o){a.$set(a.glosa,"valor_glosa",a._n(o))},expression:"glosa.valor_glosa"}}):a._e()],1):a._e(),a._v(" "),e("v-flex",{attrs:{xs12:"",sm4:"",md4:""}},[e("v-switch",{attrs:{label:"Sumar","true-value":null,"false-value":2,"hide-details":""},model:{value:a.glosa.of_facservicio,callback:function(o){a.$set(a.glosa,"of_facservicio",o)},expression:"glosa.of_facservicio"}})],1)]:a._e(),a._v(" "),e("v-flex",{attrs:{xs12:""}},[e("v-textarea",{attrs:{rows:"1","auto-grow":"",label:"Observaciones"},model:{value:a.glosa.observacion,callback:function(o){a.$set(a.glosa,"observacion",o)},expression:"glosa.observacion"}})],1)]:a._e()],2)],1),a._v(" "),e("v-divider"),a._v(" "),e("v-card-actions",[e("v-spacer"),a._v(" "),e("span",{staticClass:"caption error--text mr-3"},[e("strong",[a._v(a._s(a.errorSobreValorado))])]),a._v(" "),e("v-btn",{attrs:{flat:""},on:{click:function(o){return o.stopPropagation(),a.$emit("cancelar")}}},[a._v("Cancelar")]),a._v(" "),e("v-btn",{attrs:{flat:"",color:"success"},on:{click:function(o){return o.stopPropagation(),a.registraGlosa(o)}}},[a._v("Registrar")])],1)],1)},t=[],l={render:s,staticRenderFns:t};o.a=l}});
//# sourceMappingURL=303.745e5eaa0147efd7cf0b.js.map