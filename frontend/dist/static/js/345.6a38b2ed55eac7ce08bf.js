webpackJsonp([345],{1427:function(i,a,o){"use strict";function t(i){o(1428)}Object.defineProperty(a,"__esModule",{value:!0});var s=o(945),e=o(1434),d=o(1),r=t,n=d(s.a,e.a,!1,r,"data-v-79bb70da",null);a.default=n.exports},1428:function(i,a,o){var t=o(1429);"string"==typeof t&&(t=[[i.i,t,""]]),t.locals&&(i.exports=t.locals);o(456)("f504d1f0",t,!0,{})},1429:function(i,a,o){a=i.exports=o(455)(!0),a.push([i.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroRedServicios.vue",sourceRoot:""}])},1434:function(i,a,o){"use strict";var t=function(){var i=this,a=i.$createElement,o=i._self._c||a;return o("v-layout",{attrs:{row:"",wrap:""}},[o("loading",{model:{value:i.loading,callback:function(a){i.loading=a},expression:"loading"}}),i._v(" "),i.portabilidad?o("v-flex",{attrs:{xs12:""}},[o("expand-portabilidad",{attrs:{portabilidad:i.portabilidad}})],1):i._e(),i._v(" "),o("v-flex",{staticClass:"pa-0",attrs:{xs12:""}},[o("v-data-table",{attrs:{headers:i.headersPrimarios,items:i.serviciosHabilitar,"hide-actions":"","no-data-text":i.loading?"Cargando servicios habilitados":"No hay servicios habilitados"},scopedSlots:i._u([{key:"items",fn:function(a){return[o("td",{attrs:{width:"50%"}},[[o("v-list-tile-content",{staticClass:"truncate-content"},[o("v-list-tile-title",{staticClass:"font-weight-bold"},[i._v(i._s(a.item.codigo)+" - "+i._s(a.item.nombre))]),i._v(" "),o("v-list-tile-title",[i._v(i._s(i.esPortabilidad?a.item.asignado_portabilidad.nombre:a.item.asignado_contratado.nombre))]),i._v(" "),(i.esPortabilidad?a.item.asignado_portabilidad.cod_habilitacion:a.item.asignado_contratado.cod_habilitacion)?o("v-list-tile-sub-title",{staticClass:"caption"},[i._v("C贸digo habilitaci贸n: "+i._s(i.esPortabilidad?a.item.asignado_portabilidad.cod_habilitacion:a.item.asignado_contratado.cod_habilitacion))]):i._e()],1)]],2),i._v(" "),i.esPortabilidad?i._e():o("td",[a.item.habilitados.length?o("v-autocomplete",{attrs:{placeholder:"Seleccionar IPS",items:a.item.habilitados,"item-value":"id","item-text":"nombre",filter:i.filterIPSs,clearable:"","persistent-hint":"",hint:i.seleccionados[a.index]?"C贸digo: "+a.item.habilitados.find(function(o){return o.id===i.seleccionados[a.index]}).cod_habilitacion:""},on:{change:function(o){return i.asociarIdsEntreServicioConIps(a.index)}},scopedSlots:i._u([{key:"item",fn:function(a){return[[o("v-list-tile-content",[o("v-list-tile-title",{domProps:{innerHTML:i._s(a.item.nombre)}}),i._v(" "),o("v-list-tile-sub-title",{domProps:{innerHTML:i._s("C贸digo: "+a.item.cod_habilitacion)}})],1)]]}}],null,!0),model:{value:i.seleccionados[a.index],callback:function(o){i.$set(i.seleccionados,a.index,o)},expression:"seleccionados[props.index]"}}):o("span",[i._v("\n            No disponible\n          ")])],1)]}}])})],1),i._v(" "),i.esPortabilidad?i._e():o("v-flex",{staticClass:"pa-0",attrs:{xs12:""}},[[o("v-divider"),i._v(" "),o("v-card-actions",[o("v-spacer"),i._v(" "),o("v-btn",{attrs:{flat:"",color:"primary"},on:{click:function(a){return a.stopPropagation(),i.submit(a)}}},[i._v("Registrar")])],1)]],2)],1)},s=[],e={render:t,staticRenderFns:s};a.a=e},945:function(i,a,o){"use strict";var t=o(7),s=o.n(t);a.a={name:"RegistroRedServicios",props:{afiliado:{type:Object,default:null},afiliadoId:{type:Number,default:0}},components:{ExpandPortabilidad:function(){return o.e(337).then(o.bind(null,1430))}},data:function(){return{portabilidad:null,loading:!1,esPortabilidad:!1,serviciosHabilitar:[],headersPrimarios:[],seleccionados:[],idsServiciosYEntidades:[],filterIPSs:function(i,a){var o=function(i){return null!=i?i:""},t=o(i.cod_habilitacion+" "+i.nombre),s=o(a);return t.toString().toLowerCase().indexOf(s.toString().toLowerCase())>-1}}},created:function(){this.getData()},watch:{},methods:{submit:function(){var i=this;this.loading=!0,this.axios.post("afiliados/"+this.afiliado.id+"/servicios/sync",{servicios_habilitados:JSON.parse(s()(window.lodash.difference(this.idsServiciosYEntidades.filter(Boolean),this.afiliado.servicios_habilitados.map(function(i){return i.id}))))}).then(function(a){i.$store.commit("SNACK_SHOW",{msg:"Los servicios se han asignado satisfactoriamente. ",color:"success"}),i.afiliado.servicios_habilitados=a.data,i.idsServiciosYEntidades=[],i.getData()}).catch(function(a){i.loading=!1,i.$store.commit("SNACK_ERROR_LIST",{expression:" al asignar los servicios. ",error:a})})},getData:function(){var i=this;this.loading=!0,this.axios.get("afiliados/"+this.afiliadoId).then(function(a){i.portabilidad=a.data.data.portabilidad_activa,i.afiliado.servicios_contratados=a.data.data.servicios_contratados,i.afiliado.servicios_habilitados=a.data.data.servicios_habilitados,i.afiliado.servicios_portabilidad=a.data.data.servicios_portabilidad,i.axios.get("servicios/primarios").then(function(a){i.reOrderData(a),i.loading=!1}).catch(function(a){i.loading=!1,i.$store.commit("SNACK_ERROR_LIST",{expression:" al traer los servicios habilitados. ",error:a})})}).catch(function(a){i.loading=!1,i.$store.commit("SNACK_ERROR_LIST",{expression:" al traer los datos del afiliado. ",error:a})})},reOrderData:function(i){var a=this;this.headersPrimarios=[{text:"Servicio",align:"left",sortable:!1,value:"nombre"}],this.esPortabilidad=!!i.data.data[0].habilitados_portabilidad;var o=i.data.data.map(function(i){return{id:i.id,codigo:i.codigo,nombre:i.nombre,habilitados_portabilidad:a.esPortabilidad?i.habilitados_portabilidad.map(function(i){return{id:i.id,rs_servicio_id:i.rs_servicio_id,cod_habilitacion:i.entidad.cod_habilitacion,nombre:i.entidad.nombre}}):[],asignado_portabilidad:a.esPortabilidad&&a.afiliado.servicios_portabilidad&&a.afiliado.servicios_portabilidad.find(function(a){return a.rs_servicio_id===i.id})?{nombre:a.afiliado.servicios_portabilidad.find(function(a){return a.rs_servicio_id===i.id}).entidad.nombre,cod_habilitacion:a.afiliado.servicios_portabilidad.find(function(a){return a.rs_servicio_id===i.id}).entidad.cod_habilitacion}:{nombre:"No asignado",cod_habilitacion:null},asignado_contratado:a.esPortabilidad?{nombre:"No asignado",cod_habilitacion:null}:a.afiliado.servicios_habilitados&&a.afiliado.servicios_habilitados.find(function(a){return a.rs_servicio_id===i.id})?{nombre:a.afiliado.servicios_habilitados.find(function(a){return a.rs_servicio_id===i.id}).entidad.nombre,cod_habilitacion:a.afiliado.servicios_habilitados.find(function(a){return a.rs_servicio_id===i.id}).entidad.cod_habilitacion}:{nombre:"No asignado",cod_habilitacion:null},habilitados:i.habilitados?i.habilitados.map(function(i){return{id:i.id,rs_servicio_id:i.rs_servicio_id,cod_habilitacion:i.entidad?i.entidad.cod_habilitacion:"No registra entidad "+i.rs_entidad_id,nombre:i.entidad?i.entidad.nombre:"No registra entidad"}}):[]}});this.serviciosHabilitar=o,this.seleccionados=[],this.serviciosHabilitar.forEach(function(i){a.esPortabilidad?a.seleccionados.push(a.afiliado.servicios_portabilidad&&a.afiliado.servicios_portabilidad.find(function(a){return a.rs_servicio_id===i.id})?a.afiliado.servicios_portabilidad.find(function(a){return a.rs_servicio_id===i.id}).id:null):a.seleccionados.push(a.afiliado.servicios_habilitados&&a.afiliado.servicios_habilitados.find(function(a){return a.rs_servicio_id===i.id})?a.afiliado.servicios_habilitados.find(function(a){return a.rs_servicio_id===i.id}).id:null)}),this.esPortabilidad||this.headersPrimarios.push({text:"Reasignar IPS",align:"center",sortable:!1,value:"id"})},asociarIdsEntreServicioConIps:function(i){this.idsServiciosYEntidades.push({idServicio:this.serviciosHabilitar[i].id,idEntidad:this.seleccionados[i]}),console.log(this.idsServiciosYEntidades)}}}}});
//# sourceMappingURL=345.6a38b2ed55eac7ce08bf.js.map