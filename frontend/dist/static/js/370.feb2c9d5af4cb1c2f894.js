webpackJsonp([370],{1118:function(e,t,a){"use strict";var i=a(23),o=a.n(i),r=a(13),s=a.n(r),n=a(14),l=a.n(n),c=a(7),d=a.n(c),m=a(59),v=a(58),u=a(12),f=a(248);t.a={name:"RegistroNovedades",props:["value"],components:{CkeditorTextarea:function(){return new Promise(function(e){e()}).then(a.bind(null,268))},Loading:v.default,Confirmar:function(){return a.e(289).then(a.bind(null,749))}},data:function(){return{dialogA:{visible:!1,content:null},showFormRegistro:!1,loading:!1,flagReload:!0,item:null,makeItem:{id:null,tipo:null,fecha:null,valor:null,plazo_meses:null,plazo_dias:null,descripcion:"",ce_proconminuta_id:null,estado:"Registrada"},menuDate:!1,minDate:"1900-01-01",maxDate:(new Date).toISOString().substr(0,10),headers:[{text:"Tipo",align:"left",sortable:!1,value:"tipo"},{text:"Fecha",align:"left",sortable:!1,value:"fecha"},{text:"Estado",align:"center",sortable:!1,value:"estado"},{text:"Opciones",align:"center",sortable:!1,value:"id"}]}},watch:{showFormRegistro:function(e){!e&&this.refreshNovedad()},"item.tipo":function(e){e&&this.flagReload&&(this.item.plazo_meses=null,this.item.plazo_dias=null,this.item.valor=null)}},computed:{complementosNovedades:function(){if(m.b.getters.complementosContratoFormNovedad)return this.value.novedades.length>0&&this.value.novedades.find(function(e){return"Acta Inicio"===e.tipo&&"Confirmada"===e.estado})?JSON.parse(d()(m.b.getters.complementosContratoFormNovedad)).tiposNovedad.filter(function(e){return"Acta Inicio"!==e}):JSON.parse(d()(m.b.getters.complementosContratoFormNovedad)).tiposNovedad.filter(function(e){return"Acta Inicio"===e})}},created:function(){this.refreshNovedad()},methods:{novedadEditar:function(e){var t=this;this.flagReload=!1,this.refreshNovedad(),this.item=JSON.parse(d()(e)),this.item.fecha=this.moment(this.item.fecha).format("YYYY-MM-DD"),this.$vuetify.goTo("#flag-top",{selector:"#flag-top",duration:300,offset:-120,easing:"easeInOutQuad"}),this.showFormRegistro=!0,setTimeout(function(){t.flagReload=!0},300)},novedadPreguntaConfirmar:function(e){this.flagReload=!1,this.showFormRegistro=!1,this.dialogA.content="Si confirma la novedad, ésta ya no se podrá editar. </br><strong>¿Está seguro de confirmar la novedad: "+e.tipo+"?</strong>",this.item=e,this.dialogA.visible=!0},cancelaNovedadPreguntaConfirmar:function(){this.dialogA.visible=!1,this.dialogA.content=null,this.flagReload=!0,this.refreshNovedad()},confirmaNovedad:function(){var e=this;return l()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.item.estado="Confirmada",console.log("tihos.item",e.item),t.next=4,e.registroItem();case 4:if(!t.sent){t.next=7;break}e.cancelaNovedadPreguntaConfirmar(),setTimeout(function(){e.flagReload=!0},300);case 7:case"end":return t.stop()}},t,e)}))()},registroItem:function(){var e=this;this.loading=!0,this.item.ce_proconminuta_id=this.value.id;var t=this.item.id?"editar":"crear",a="editar"===t?this.axios.put("contratos/"+this.value.id+"/novcontratos/"+this.item.id,this.item):this.axios.post("contratos/"+this.value.id+"/novcontratos",this.item);return new o.a(function(i){a.then(function(a){console.log("response al guardar la novedad",a),e.$store.commit(u.b,{msg:"La novedad se ha "+("Confirmada"===e.item.estado?"confirmado":"registrado")+" correctamente.",color:"success"}),e.$store.commit(f.y,{item:a.data.contrato_o,estado:t,key:null}),e.$emit("input",a.data.contrato),e.showFormRegistro=!1,e.loading=!1,i(!0)}).catch(function(t){e.loading=!1,e.$store.commit(u.a,{expression:" al realizar el registro de la novedad. ",error:t}),i(!1)})})},submitItem:function(){var e=this;this.$validator.validateAll().then(function(t){t&&e.registroItem()})},refreshNovedad:function(){this.item=JSON.parse(d()(this.makeItem)),this.$validator.reset(),this.value.fecha_acta_inicio||(this.item.tipo="Acta Inicio")}}}},1963:function(e,t,a){"use strict";function i(e){a(1964)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(1118),r=a(1966),s=a(1),n=i,l=s(o.a,r.a,!1,n,"data-v-729c0a3c",null);t.default=l.exports},1964:function(e,t,a){var i=a(1965);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(456)("9f77a29a",i,!0,{})},1965:function(e,t,a){t=e.exports=a(455)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"RegistroNovedades.vue",sourceRoot:""}])},1966:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card-text",[a("v-layout",{attrs:{row:"",wrap:"",id:"flag-top"}},[a("loading",{model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}}),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("v-card",[a("v-toolbar",{staticClass:"elevation-0",attrs:{dense:""}},[a("v-toolbar-title",{domProps:{innerHTML:e._s("Novedades")}}),e._v(" "),a("small",{staticClass:"mt-2 ml-1"},[e._v(" Registro y gestión")]),e._v(" "),a("v-spacer"),e._v(" "),!e.showFormRegistro&&e.value.novedades&&(e.value.novedades.length>0&&e.value.novedades.find(function(e){return"Acta Inicio"===e.tipo&&"Confirmada"===e.estado})||0===e.value.novedades.length)?a("v-tooltip",{attrs:{top:""}},[a("v-btn",{attrs:{slot:"activator",fab:"",right:"",small:"",color:"accent"},on:{click:function(t){e.showFormRegistro=!0}},slot:"activator"},[a("v-icon",[e._v("add")])],1),e._v(" "),a("span",[e._v("Crear novedad")])],1):e._e()],1),e._v(" "),a("v-expand-transition",[e.showFormRegistro?a("div",[a("v-card-text",[a("v-form",[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[a("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Tipo",items:e.complementosNovedades,name:"Tipo","error-messages":e.errors.collect("Tipo")},model:{value:e.item.tipo,callback:function(t){e.$set(e.item,"tipo",t)},expression:"item.tipo"}})],1),e._v(" "),a("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[a("v-menu",{ref:"Fecha",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:e.menuDate,callback:function(t){e.menuDate=t},expression:"menuDate"}},[a("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY-MM-DD|date_between:"+e.minDate+","+e.maxDate+",true",expression:"'required|date_format:YYYY-MM-DD|date_between:' + minDate + ',' + maxDate + ',true'"}],attrs:{slot:"activator",label:"Fecha",name:"Fecha","prepend-icon":"event","error-messages":e.errors.collect("Fecha"),readonly:""},slot:"activator",model:{value:e.item.fecha,callback:function(t){e.$set(e.item,"fecha",t)},expression:"item.fecha"}}),e._v(" "),a("v-date-picker",{ref:"picker",attrs:{locale:"es-co",max:e.maxDate,min:e.minDate},on:{input:function(t){return e.$refs.Fecha.save(e.item.fecha)},change:function(){var t=e.$validator.errors.items.findIndex(function(e){return"Fecha"===e.field});e.$validator.errors.items.splice(-1!==t?t:0,-1!==t?1:0)}},model:{value:e.item.fecha,callback:function(t){e.$set(e.item,"fecha",t)},expression:"item.fecha"}})],1)],1),e._v(" "),null!==e.item.tipo&&"Acta Inicio"!==e.item.tipo?[a("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[a("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|min_value:0",expression:"'required|min_value:0'"}],attrs:{"prepend-icon":"attach_money",label:"Valor",name:"Valor",min:"0",type:"number","error-messages":e.errors.collect("Valor")},model:{value:e.item.valor,callback:function(t){e.$set(e.item,"valor",e._n(t))},expression:"item.valor"}})],1),e._v(" "),a("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[a("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"numeric|required|min_value:0",expression:"'numeric|required|min_value:0'"}],attrs:{label:"Plazo meses",min:"0",type:"number",name:"Plazo meses","error-messages":e.errors.collect("Plazo meses")},model:{value:e.item.plazo_meses,callback:function(t){e.$set(e.item,"plazo_meses",e._n(t))},expression:"item.plazo_meses"}})],1),e._v(" "),a("v-flex",{attrs:{xs12:"",sm6:"",md4:""}},[a("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"numeric|required|min_value:0",expression:"'numeric|required|min_value:0'"}],attrs:{label:"Plazo días",min:"0",type:"number",name:"Plazo días","error-messages":e.errors.collect("Plazo días")},model:{value:e.item.plazo_dias,callback:function(t){e.$set(e.item,"plazo_dias",e._n(t))},expression:"item.plazo_dias"}})],1)]:e._e(),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("span",{staticClass:"caption"},[e._v("Descripción")]),e._v(" "),a("ckeditor-textarea",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"descripción","error-messages":e.errors.collect("descripción")},model:{value:e.item.descripcion,callback:function(t){e.$set(e.item,"descripcion",t)},expression:"item.descripcion"}})],1)],2)],1)],1),e._v(" "),a("v-divider"),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{flat:""},on:{click:function(t){t.stopPropagation(),e.showFormRegistro=!1}}},[e._v("Cancelar")]),e._v(" "),a("v-btn",{attrs:{color:"primary"},on:{click:function(t){return t.stopPropagation(),e.submitItem(t)}}},[e._v("Registrar")])],1)],1):e._e()])],1)],1),e._v(" "),a("v-flex",{staticClass:"pa-0 ma-0",attrs:{xs12:""}},[a("v-card",{staticClass:"elevation-0"},[a("v-data-table",{attrs:{headers:e.headers,items:e.value.novedades,"hide-actions":"","no-data-text":"No hay novedades registradas"},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.tipo))]),e._v(" "),a("td",[e._v(e._s(e.moment(t.item.fecha).format("YYYY-MM-DD")))]),e._v(" "),a("td",{staticClass:"text-xs-center"},[e._v(e._s(t.item.estado))]),e._v(" "),a("td",{staticClass:"text-xs-center",attrs:{width:"Registrada"===t.item.estado?"110px":"50px"}},["Registrada"===t.item.estado?[a("v-tooltip",{attrs:{top:""}},[a("v-btn",{staticClass:"ma-0",attrs:{slot:"activator",flat:"",icon:"",small:"",color:"accent"},on:{click:function(a){return e.novedadPreguntaConfirmar(t.item)}},slot:"activator"},[a("v-icon",{attrs:{small:""}},[e._v("done_all")])],1),e._v(" "),a("span",[e._v("Confirmar")])],1),e._v(" "),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{staticClass:"ma-0",attrs:{slot:"activator",flat:"",icon:"",small:"",color:"accent"},on:{click:function(a){return e.novedadEditar(t.item)}},slot:"activator"},[a("v-icon",{attrs:{small:""}},[e._v("edit")])],1),e._v(" "),a("span",[e._v("Editar")])],1)]:e._e()],2)]}}])})],1)],1),e._v(" "),a("confirmar",{attrs:{value:e.dialogA.visible,content:e.dialogA.content,"requiere-motivo":!1},on:{cancelar:e.cancelaNovedadPreguntaConfirmar,aceptar:e.confirmaNovedad}})],1)],1)},o=[],r={render:i,staticRenderFns:o};t.a=r}});
//# sourceMappingURL=370.feb2c9d5af4cb1c2f894.js.map