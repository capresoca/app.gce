webpackJsonp([163],{1199:function(e,t,s){"use strict";var o=s(23),r=s.n(o),a=s(7),i=s.n(a),n=s(12),l=s(59),u=s(58),d=s(40),c=s(248),v=s(251);t.a={name:"PresupuestoInicialDeGastos",props:["parametros"],components:{Loading:u.default},data:function(){return{presupuesto:null,entidad:null,presupuestos:[],rubros:[],detalle:{},dialogConfirm:!1,detalleAEliminar:{},localLoading:!1,valorPresupuesto:0,seEstaCreando:!1,rubrosCreados:"",tableLoading:!1,loadingSubmit:!1,disabledValorInicial:!1,dialog:!1,headers:[{text:"Rubro",align:"left",sortable:!1,value:"rubro"},{text:"Nombre",align:"left",sortable:!1,value:"nombre"},{text:"Tipo",align:"left",sortable:!1,value:"tipo"},{text:"Valor",align:"left",sortable:!1,value:"valor"},{text:"Opciones",align:"center",sortable:!1,value:"id"}]}},beforeMount:function(){this.presupuesto={entidad_resolucion:{id:"",periodo:null,rubro:null,codigo:null,resolucion:null,valor:null,nombre:null},detalles:[],estado:""},this.validadorPostulador()},mounted:function(){null!==this.parametros.entidad?this.getRegisto(this.parametros.entidad.id):this.obtenerPresupuestos(),this.formReset(),this.obtenerRubros();var e={custom:{rubro:{not_in:"Este rubro ya fue registrado."}}};this.$validator.localize("es",e)},computed:{complementos:function(){return JSON.parse(i()(l.b.getters.complementosPresupuesto))},iconoEstado:function(){return"Registrada"===this.presupuesto.estado?"stars":"Confirmada"===this.presupuesto.estado?"check_circle":void 0},colorEstado:function(){return"Registrada"===this.presupuesto.estado?"primary":"Confirmada"===this.presupuesto.estado?"teal":void 0}},watch:{"detalle.pr_rubro_id":function(e){e&&(this.detalle.rubro=this.rubros.find(function(t){return t.id===e}))},"detalle.rubro_sin_presupuesto":function(e){1===e&&(this.detalle.valor_inicial=0,this.disabledValorInicial=!0),0===e&&(this.detalle.valor_inicial=null,this.disabledValorInicial=!1)}},methods:{imprimir:function(e){var t=this;this.axios.get("firmar-ruta?nombre_ruta=reporte-pr-gastos&id="+e).then(function(e){var t=e.data;window.open(t,"_blank").focus()}).catch(function(){t.$store.commit(n.b,{msg:"Error al abrir el archivo de impresión. ",color:"danger"})})},getRegisto:function(e){var t=this,s=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("pr_strgastos/"+e).then(function(e){""!==e.data&&(t.presupuesto=e.data.data,t.calcularValorPresupuesto(),t.formReset()),s.hide()}).catch(function(e){s.hide(),t.$store.commit(n.b,{msg:"Hay un error al traer el registro. "+e,color:"danger"})})},obtenerPresupuesto:function(e){var t=this,s=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("entidades_resolucion_gastos/"+e).then(function(e){""!==e.data&&(t.entidad=e.data.data,t.llenarPresupuesto(),t.calcularValorPresupuesto()),s.hide()}).catch(function(e){s.hide(),t.$store.commit(n.b,{msg:"Hay un error al traer el presupuesto. "+e,color:"danger"})})},obtenerPresupuestos:function(){var e=this;this.seEstaCreando=!0;var t=this.$loading.show({container:this.$refs.formPresupuesto.$el});this.axios.get("periodos_strgastos").then(function(s){""!==s.data&&(e.presupuestos=s.data),t.hide()}).catch(function(s){t.hide(),e.$store.commit(n.a,{expression:" al obtener los presupuestos. ",error:s})})},obtenerRubros:function(){var e=this;this.axios.get("rubros?tipo_rubro=Gastos").then(function(t){e.rubros=t.data.data}).catch(function(t){e.$store.commit(n.b,{msg:"Hay un error al traer los rubros. "+t,color:"danger"})})},llenarPresupuesto:function(){this.presupuesto.periodo=this.entidad.periodo,this.presupuesto.pr_entidad_resolucion_id=this.entidad.id,this.presupuesto.estado="Registrada",this.presupuesto.entidad_resolucion=this.entidad},calcularValorPresupuesto:function(){var e=this;this.valorPresupuesto=0,this.presupuesto.detalles.map(function(t){e.valorPresupuesto+=parseInt(t.valor_inicial)})},getRubrosUsados:function(){var e=this;return this.presupuesto.detalles.map(function(t){if(null==e.detalle.rubro.id||e.detalle.rubro.id!==t.rubro.id)return t.rubro.id})},formReset:function(){this.detalle={rubro:{id:"",codigo:""},tipo_gasto:{nombre:null},valor_inicial:null,rubro_sin_presupuesto:0},this.$validator.reset(),this.rubrosCreados=this.getRubrosUsados()},abrirModal:function(){this.dialog=!0,this.rubrosCreados=this.getRubrosUsados()},agregarDetalle:function(e){var t=this;"number"!=typeof e.index?this.presupuesto.detalles.push(e):this.presupuesto.detalles.splice(this.presupuesto.detalles.findIndex(function(s){return t.presupuesto.detalles.indexOf(s)===e.index}),1,e),this.calcularValorPresupuesto(),this.dialog=!1,this.formReset()},editarDetalle:function(e,t){this.detalle=JSON.parse(i()(t)),this.detalle.index=e,this.rubrosCreados=this.getRubrosUsados(),this.abrirModal()},eliminarDetalle:function(e){this.presupuesto.detalles.splice(e,1),this.calcularValorPresupuesto(),this.dialogConfirm=!1},filterRubros:function(e,t){var s=function(e){return null!=e?e:""},o=s(e.nombre+" "+e.codigo),r=s(t);return o.toString().toLowerCase().indexOf(r.toString().toLowerCase())>-1},validadorPostulador:function(){var e=this;v.a.extend("rubroValido",{validate:function(t,s){return new r.a(function(s){var o={};if(null!==t&&void 0!==t&&""!==t)return o=e.rubrosCreados.includes(t.id)?{valido:!1,mensaje:"Rubro ya usado"}:{valido:!0,mensaje:null},s({valid:o.valido,data:{message:o.mensaje}})})},getMessage:function(e,t,s){return s.message}})},close:function(){this.dialog=!1,this.formReset()},confirmar:function(){this.presupuesto.estado="Confirmada",this.submit()},submit:function(){var e=this;this.localLoading=!0;var t=this.seEstaCreando?"crear":"editar";(this.seEstaCreando?this.axios.post("pr_strgastos",this.presupuesto):this.axios.put("pr_strgastos/"+this.presupuesto.id,this.presupuesto)).then(function(s){e.seEstaCreando?(e.$store.commit(n.b,{msg:"Item creado satisfactoriamente",color:"success"}),e.$store.commit(c._7,{item:s.data.data,estado:t,key:e.parametros.key}),e.$store.dispatch(d.c,{contexto:e,itemId:e.parametros.tabOrigin})):(e.$store.commit(n.b,{msg:"Item actualizado satisfactoriamente",color:"success"}),e.$store.commit(c._7,{item:s.data.data,estado:t,key:e.parametros.key}),e.$store.dispatch(d.c,{contexto:e,itemId:e.parametros.tabOrigin}))}).catch(function(t){e.localLoading=!1,e.$store.commit(n.a,{expression:" al guardar el registro. ",error:t})})}}}},2137:function(e,t,s){var o=s(2138);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);s(456)("7ef53ef6",o,!0,{})},2138:function(e,t,s){t=e.exports=s(455)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"PresupuestoInicialDeGastos.vue",sourceRoot:""}])},2139:function(e,t,s){"use strict";var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-dialog",{attrs:{width:"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-form",{attrs:{"data-vv-scope":"formCajas"},on:{submit:function(t){return t.preventDefault(),e.agregarDetalle(e.detalle)}}},[s("v-card",[s("v-card-title",{staticClass:"grey lighten-3 elevation-0"},[s("span",{staticClass:"title"},[e._v("Nuevo rubro")])]),e._v(" "),s("v-container",{attrs:{fluid:"","grid-list-md":""}},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:""}},[s("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required|rubroValido",expression:"'required|rubroValido'"}],attrs:{label:"Rubro",items:e.rubros,filter:e.filterRubros,hint:e.detalle.rubro?e.detalle.rubro.codigo:"","persistent-hint":"","item-text":"nombre","item-value":"id",name:"rubro","prepend-icon":"subtitles",required:"",required:"","return-object":"","error-messages":e.errors.collect("rubro")},on:{change:function(t){return e.detalle.pr_rubro_id=t?t.id:null}},scopedSlots:e._u([{key:"item",fn:function(t){return[[s("v-list-tile-content",[s("v-list-tile-title",{domProps:{innerHTML:e._s(t.item.nombre)}}),e._v(" "),s("v-list-tile-sub-title",{domProps:{innerHTML:e._s(t.item.codigo)}})],1)]]}}]),model:{value:e.detalle.rubro,callback:function(t){e.$set(e.detalle,"rubro",t)},expression:"detalle.rubro"}})],1),e._v(" "),s("v-flex",{attrs:{xs12:""}},[s("v-autocomplete",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"Tipo gasto",items:e.complementos.tipoGastos,"item-value":"id","item-text":"nombre",name:"tipo gastos","prepend-icon":"compare_arrows",required:"","return-object":"","error-messages":e.errors.collect("tipo gastos")},on:{change:function(t){return e.detalle.pr_tipo_gasto_id=t?t.id:null}},scopedSlots:e._u([{key:"item",fn:function(t){return[[s("v-list-tile-content",[s("v-list-tile-title",{domProps:{innerHTML:e._s(t.item.nombre)}}),e._v(" "),s("v-list-tile-sub-title",{domProps:{innerHTML:e._s(t.item.nombre_departamento)}})],1)]]}}]),model:{value:e.detalle.tipo_gasto,callback:function(t){e.$set(e.detalle,"tipo_gasto",t)},expression:"detalle.tipo_gasto"}})],1),e._v(" "),s("v-flex",{attrs:{xs12:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|numeric",expression:"'required|numeric'"}],attrs:{label:"Valor","prepend-icon":"attach_money",disabled:e.disabledValorInicial,name:"valor",required:"","error-messages":e.errors.collect("valor")},model:{value:e.detalle.valor_inicial,callback:function(t){e.$set(e.detalle,"valor_inicial",t)},expression:"detalle.valor_inicial"}})],1),e._v(" "),s("v-flex",{attrs:{xs12:""}},[s("v-subheader",{staticClass:"pa-0 ma-0"},[e._v("Rubro sin presupuesto")]),e._v(" "),s("v-switch",{staticClass:"ma-0 pa-0",attrs:{color:"accent","true-value":1,"false-value":0},model:{value:e.detalle.rubro_sin_presupuesto,callback:function(t){e.$set(e.detalle,"rubro_sin_presupuesto",t)},expression:"detalle.rubro_sin_presupuesto"}})],1)],1)],1),e._v(" "),s("v-card-actions",{staticClass:"grey lighten-4"},[s("v-spacer"),e._v(" "),s("v-btn",{on:{click:e.close}},[e._v("Cancelar")]),e._v(" "),s("v-btn",{attrs:{type:"submit",color:"primary"}},[e._v("Guardar")])],1)],1)],1)],1),e._v(" "),s("v-card",{ref:"formPresupuesto"},[s("v-toolbar",{staticClass:"grey lighten-3 elevation-0 toolbar--dense"},[s("v-toolbar-title",[e._v(" Presupuesto inicial de gastos ")]),e._v(" "),s("v-spacer"),e._v(" "),e.seEstaCreando?e._e():s("v-chip",{attrs:{color:e.colorEstado,"text-color":"white"}},[s("v-avatar",[s("v-icon",[e._v(e._s(e.iconoEstado))])],1),e._v("\n        "+e._s(e.presupuesto.estado)+"\n      ")],1)],1),e._v(" "),s("v-container",{staticStyle:{"max-width":"inherit"},attrs:{"grid-list-md":""}},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:""}},[s("v-form",{attrs:{"data-vv-scope":"formLiquidaciones"}},[s("v-container",{attrs:{fluid:"","grid-list-md":""}},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{staticClass:"pb-4",attrs:{xs12:""}},[s("v-card",[s("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[s("v-toolbar-title",{staticClass:"subheading"},[s("v-icon",[e._v("assignment_ind")]),e._v(" General")],1)],1),e._v(" "),s("v-card-text",[s("v-layout",{attrs:{row:"",wrap:""}},[null!==this.parametros.entidad?s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-text-field",{key:"periodo",attrs:{"prepend-icon":"calendar_today",label:"Periodo",readonly:""},model:{value:e.presupuesto.entidad_resolucion.periodo,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"periodo",t)},expression:"presupuesto.entidad_resolucion.periodo"}})],1):s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{items:e.presupuestos,name:"periodo",label:"Periodo","no-data-text":"No hay resoluciones disponibles","error-messages":e.errors.collect("periodo"),required:"","prepend-icon":"calendar_today"},on:{change:function(t){return e.obtenerPresupuesto(t)}},model:{value:e.presupuesto.entidad_resolucion.periodo,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"periodo",t)},expression:"presupuesto.entidad_resolucion.periodo"}})],1),e._v(" "),s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-text-field",{key:"unidad ejecturoa",attrs:{"prepend-icon":"account_balance",label:"Unidad ejecutora",readonly:""},model:{value:e.presupuesto.entidad_resolucion.codigo,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"codigo",t)},expression:"presupuesto.entidad_resolucion.codigo"}})],1),e._v(" "),s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-text-field",{key:"nombre",attrs:{"prepend-icon":"account_balance",label:"Nombre",readonly:""},model:{value:e.presupuesto.entidad_resolucion.nombre,callback:function(t){e.$set(e.presupuesto.entidad_resolucion,"nombre",t)},expression:"presupuesto.entidad_resolucion.nombre"}})],1)],1)],1)],1)],1),e._v(" "),s("v-flex",{staticClass:"pb-4",attrs:{xs12:""}},[s("v-card",[s("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[s("v-toolbar-title",{staticClass:"subheading"},[s("v-icon",[e._v("monetization_on")]),e._v(" Presupuesto")],1)],1),e._v(" "),s("v-card-text",[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:""}},[s("v-card",[s("v-card-title",[s("h4",[e._v("Resolución")])]),e._v(" "),s("v-divider"),e._v(" "),s("v-list",{attrs:{dense:""}},[s("v-list-tile",[s("v-list-tile-content",[e._v(e._s(e.presupuesto.entidad_resolucion.resolucion))])],1)],1)],1)],1),e._v(" "),s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-card",[s("v-card-title",[s("h4",[e._v("Valor resolución")])]),e._v(" "),s("v-divider"),e._v(" "),s("v-list",{attrs:{dense:""}},[s("v-list-tile",[s("v-list-tile-content",{staticClass:"align-center"},[e._v(e._s(e._f("numberFormat")(e.presupuesto.entidad_resolucion.valor,0,"$")))])],1)],1)],1)],1),e._v(" "),s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-card",[s("v-card-title",[s("h4",[e._v("Valor presupuesto")])]),e._v(" "),s("v-divider"),e._v(" "),s("v-list",{attrs:{dense:""}},[s("v-list-tile",[s("v-list-tile-content",{staticClass:"align-center"},[e._v(e._s(e._f("numberFormat")(e.valorPresupuesto,0,"$")))])],1)],1)],1)],1),e._v(" "),s("v-flex",{attrs:{xs12:"",sm4:""}},[s("v-card",[s("v-card-title",[s("h4",[e._v("Diferencia")])]),e._v(" "),s("v-divider"),e._v(" "),s("v-list",{attrs:{dense:""}},[s("v-list-tile",[s("v-list-tile-content",{staticClass:"align-center"},[e._v(e._s(e._f("numberFormat")(parseInt(e.presupuesto.entidad_resolucion.valor)-e.valorPresupuesto,0,"$",[".",".","-"])))])],1)],1)],1)],1),e._v(" "),s("v-flex",{attrs:{xs12:""}},[[s("loading",{model:{value:e.localLoading,callback:function(t){e.localLoading=t},expression:"localLoading"}}),e._v(" "),s("v-card",[s("v-toolbar",{staticClass:"grey lighten-4 elevation-0",attrs:{dense:""}},[s("v-toolbar-title",{staticClass:"subheading"},[e._v("Rubros")]),e._v(" "),s("v-spacer"),e._v(" "),"Confirmada"!==e.presupuesto.estado?s("v-btn",{attrs:{small:"",color:"primary"},on:{click:function(t){return t.preventDefault(),e.abrirModal(t)}}},[s("v-icon",[e._v("add")]),e._v(" Agregar Rubro")],1):e._e()],1),e._v(" "),s("v-data-table",{attrs:{headers:e.headers,items:e.presupuesto.detalles,loading:e.tableLoading,"hide-actions":"","rows-per-page-text":"Registros por página","rows-per-page-items":[5,10,25,{text:"Todos",value:-1}]},scopedSlots:e._u([{key:"items",fn:function(t){return[s("td",[e._v(e._s(t.item.rubro.codigo))]),e._v(" "),s("td",[e._v(e._s(t.item.rubro.nombre))]),e._v(" "),s("td",[e._v(e._s(t.item.tipo_gasto.nombre))]),e._v(" "),s("td",{staticClass:"text-xs-right"},[e._v(e._s(e._f("numberFormat")(t.item.valor_inicial,0,"$")))]),e._v(" "),s("td",{staticClass:"text-xs-center"},["Confirmada"!==e.presupuesto.estado?s("v-speed-dial",{attrs:{direction:"left","open-on-hover":"",transition:"slide-x-transition"},model:{value:t.item.show,callback:function(s){e.$set(t.item,"show",s)},expression:"props.item.show"}},[s("v-btn",{attrs:{slot:"activator",color:"blue darken-2",dark:"",fab:"",small:""},slot:"activator",model:{value:t.item.show,callback:function(s){e.$set(t.item,"show",s)},expression:"props.item.show"}},[s("v-icon",[e._v("chevron_left")]),e._v(" "),s("v-icon",[e._v("close")])],1),e._v(" "),s("v-tooltip",{attrs:{top:""}},[s("v-btn",{attrs:{slot:"activator",fab:"",dark:"",small:"",color:"white"},on:{click:function(s){return e.editarDetalle(t.index,t.item)}},slot:"activator"},[s("v-icon",{attrs:{color:"accent"}},[e._v("mode_edit")])],1),e._v(" "),s("span",[e._v("Editar")])],1),e._v(" "),s("v-tooltip",{attrs:{top:""}},[s("v-btn",{attrs:{slot:"activator",fab:"",dark:"",small:"",color:"white"},on:{click:function(s){return e.eliminarDetalle(t.index,t.item.id)}},slot:"activator"},[s("v-icon",{attrs:{color:"accent"}},[e._v("delete")])],1),e._v(" "),s("span",[e._v("Eliminar")])],1)],1):e._e()],1)]}},{key:"pageText",fn:function(t){return[e._v("\n                                  "+e._s(t.pageStart)+" - "+e._s(t.pageStop)+" de "+e._s(t.itemsLength)+"\n                                ")]}}])},[e._v(" "),s("template",{slot:"no-data"},[e.tableLoading?s("v-alert",{attrs:{value:!0,color:"info",icon:"info"}},[e._v("\n                                    Estamos cargando los registros. "),s("v-icon",[e._v("sentiment_satisfied_alt")])],1):s("v-alert",{attrs:{value:!0,color:"error",icon:"warning"}},[e._v("\n                                    Lo sentimos, no tenemos registros para mostrar. "),s("v-icon",[e._v("sentiment_very_dissatisfied")])],1)],1)],2)],1)]],2)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1),e._v(" "),s("v-divider"),e._v(" "),"Confirmada"!==e.presupuesto.estado?s("v-card-actions",{staticClass:"grey lighten-4"},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{staticClass:"text-xs-right",attrs:{xs12:""}},["Confirmada"!==e.presupuesto.estado?s("v-btn",{attrs:{color:"primary",loading:e.loadingSubmit},on:{click:function(t){return t.preventDefault(),e.submit(t)}}},[e._v("Guardar")]):e._e(),e._v(" "),"Confirmada"!==e.presupuesto.estado&&parseInt(e.presupuesto.entidad_resolucion.valor)!==e.valorPresupuesto?s("v-tooltip",{attrs:{top:""}},[s("v-btn",{attrs:{slot:"activator",color:"success",disabled:parseInt(e.presupuesto.entidad_resolucion.valor)!==e.valorPresupuesto},on:{click:e.confirmar},slot:"activator"},[e.seEstaCreando?s("span",[e._v("Guardar y Confirmar")]):s("span",[e._v("Confirmar")])]),e._v(" "),s("span",[e._v("El valor de la resolución y el valor del presupuesto deben ser iguales")])],1):s("v-btn",{attrs:{slot:"activator",color:"success"},on:{click:e.confirmar},slot:"activator"},[e.seEstaCreando?s("span",[e._v("Guardar y Confirmar")]):s("span",[e._v("Confirmar")])]),e._v(" "),e.presupuesto.id?s("v-btn",{attrs:{color:"accent"},on:{click:function(t){return e.imprimir(e.presupuesto.id)}}},[s("v-icon",{domProps:{textContent:e._s("far fa-file-pdf")}})],1):e._e()],1)],1)],1):e._e()],1)],1)},r=[],a={render:o,staticRenderFns:r};t.a=a},653:function(e,t,s){"use strict";function o(e){s(2137)}Object.defineProperty(t,"__esModule",{value:!0});var r=s(1199),a=s(2139),i=s(1),n=o,l=i(r.a,a.a,!1,n,"data-v-02b5105b",null);t.default=l.exports}});
//# sourceMappingURL=163.dc9497087ad11005021e.js.map